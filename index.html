<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é›¢è·è¡é‹’ï¼š30 Days</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050508; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'PingFang TC', sans-serif; }
        canvas { background: #0d1117; border: 2px solid #30363d; border-radius: 12px; box-shadow: 0 0 50px rgba(0,0,0,0.5); touch-action: none; }
        
        /* è³ªæ„Ÿ UI */
        #ui { position: absolute; top: 30px; width: 320px; color: #fff; pointer-events: none; }
        .day-label { font-size: 28px; font-weight: 800; letter-spacing: 2px; color: #00f2ff; text-shadow: 0 0 15px #00f2ff; margin-bottom: 5px; }
        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; }
        #fill { width: 0%; height: 100%; background: linear-gradient(90deg, #00f2ff, #7000ff); box-shadow: 0 0 10px #00f2ff; transition: 0.3s; }

        /* å½ˆçª—è¨Šæ¯ */
        #msg { display: none; position: absolute; background: rgba(13, 17, 23, 0.95); border: 1px solid #00f2ff; color: #00f2ff; padding: 25px; border-radius: 4px; text-align: center; z-index: 100; box-shadow: 0 0 30px rgba(0,242,255,0.2); backdrop-filter: blur(5px); }
    </style>
</head>
<body>

<div id="ui">
    <div class="day-label">DAY <span id="day">1</span></div>
    <div class="progress-bar"><div id="fill"></div></div>
</div>

<div id="msg">
    <h2 id="m-title" style="margin:0"></h2>
    <p id="m-body" style="color:#8b949e"></p>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 360; canvas.height = 640;

const CONFIG = {
    P_SPD: 800,
    ENEMIES: [
        { n: 'ğŸ˜ˆ ä¸»ç®¡', c: '#ff3131', s: 1000, sz: 55 },
        { n: 'ğŸ˜¤ æ”¹ç¨¿', c: '#ff914d', s: 1500, sz: 45 },
        { n: 'ğŸ’€ æœƒè­°', c: '#ffde59', s: 2300, sz: 35 }
    ]
};

let day = 1, progress = 0, isPaused = false, lastT = 0, shake = 0;
let player = { x: 155, y: 560, w: 50, h: 50, isFiring: false };
let enemies = [];

const audio = new (window.AudioContext || window.webkitAudioContext)();
function play(f, t, d, v=0.1) {
    if(audio.state === 'suspended') audio.resume();
    const o = audio.createOscillator(), g = audio.createGain();
    o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
    g.gain.setValueAtTime(v, audio.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + d);
    o.connect(g); g.connect(audio.destination);
    o.start(); o.stop(audio.currentTime + d);
}

function spawn() {
    if (isPaused) return;
    const side = Math.random() > 0.5 ? 1 : -1;
    const type = CONFIG.ENEMIES[Math.floor(Math.random() * CONFIG.ENEMIES.length)];
    enemies.push({ x: side === 1 ? -100 : 460, y: 120 + Math.random() * 320, vx: type.s * side, ...type });
}
setInterval(spawn, 400);

function showMsg(t, b) {
    isPaused = true;
    const m = document.getElementById('msg');
    document.getElementById('m-title').innerText = t;
    document.getElementById('m-body').innerText = b;
    m.style.display = 'block';
    setTimeout(() => { m.style.display = 'none'; isPaused = false; }, 1200);
}

function update(dt) {
    if (isPaused) return;
    if (shake > 0) shake -= dt * 10;

    if (player.isFiring) {
        player.y -= CONFIG.P_SPD * dt;
        if (player.y < 30) {
            progress++;
            play(1000, 'sine', 0.2);
            if (progress >= 2) { day++; progress = 0; showMsg(`DAY ${day-1} CLEAR`, "é›¢è‡ªç”±æ›´è¿‘ä¸€æ­¥..."); }
            reset();
        }
    }

    enemies.forEach((e, i) => {
        e.x += e.vx * dt;
        if (player.isFiring && player.x < e.x + e.sz && player.x + player.w > e.x && player.y < e.y + e.sz && player.y + player.h > e.y) {
            play(100, 'square', 0.4, 0.2);
            shake = 5; // éœ‡å‹•æ„Ÿ
            reset();
        }
        if (e.x < -150 || e.x > 500) enemies.splice(i, 1);
    });
    
    document.getElementById('day').innerText = day;
    document.getElementById('fill').style.width = (progress / 2) * 100 + "%";
}

function reset() { player.y = 560; player.isFiring = false; }

function draw() {
    ctx.save();
    if (shake > 0) ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // èƒŒæ™¯ç¶²æ ¼
    ctx.strokeStyle = "rgba(0, 242, 255, 0.05)";
    for(let i=0; i<canvas.width; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,640); ctx.stroke(); }
    for(let i=0; i<canvas.height; i+=40) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(360,i); ctx.stroke(); }

    // æ•µäºº
    enemies.forEach(e => {
        ctx.shadowBlur = 15; ctx.shadowColor = e.c;
        ctx.fillStyle = "#fff";
        ctx.fillRect(e.x, e.y, e.sz, e.sz);
        ctx.fillStyle = "#000";
        ctx.font = "bold 14px sans-serif";
        ctx.fillText(e.n, e.x + 4, e.y + e.sz/2 + 5);
        
        // æ¥µé€Ÿæ®˜å½±
        ctx.fillStyle = e.c + "33";
        ctx.fillRect(e.x - (e.vx * 0.01), e.y, e.sz, e.sz);
    });

    // ç©å®¶ (é»ƒè‰²æ–¹å¡Šé¢¨æ ¼æ”¹è‰¯)
    ctx.shadowBlur = 20; ctx.shadowColor = "#ffde59";
    ctx.fillStyle = "#ffde59";
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = "#000";
    ctx.font = "bold 16px sans-serif";
    ctx.fillText("ğŸƒ æˆ‘", player.x + 5, player.y + 32);

    ctx.restore();
}

function loop(t) {
    let dt = (t - lastT) / 1000;
    lastT = t;
    update(dt > 0.1 ? 0 : dt);
    draw();
    requestAnimationFrame(loop);
}

const act = () => { if(!player.isFiring && !isPaused) { player.isFiring = true; play(400, 'triangle', 0.1); }};
canvas.addEventListener('mousedown', act);
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); act(); });
requestAnimationFrame(loop);
</script>
</body>
</html>
