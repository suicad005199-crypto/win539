<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿…ä¸­ v2 - æ™ºèƒ½é æ¸¬ç³»çµ±</title>
<style>
:root {
  --primary: #00ff99;
  --secondary: #274c77;
  --danger: #ff6666;
  --warning: #ffcc00;
  --bg-0: #050b15;
  --bg-1: #0f1f38;
  --bg-2: #142b4d;
  --bg-3: #1a355c;
  --bg-4: #203f6e;
  --text-light: #e0f7ff;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #0b1626, #051122);
  color: var(--text-light);
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
.header {
  text-align: center;
  padding: 30px 0;
  background: linear-gradient(90deg, var(--bg-0), var(--bg-1));
  border-radius: 20px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--warning));
}

.header h1 {
  font-size: 2.5rem;
  color: var(--primary);
  margin-bottom: 10px;
  text-shadow: 0 0 20px rgba(0, 255, 153, 0.3);
}

.subtitle {
  color: #8da1b9;
  font-size: 1.1rem;
}

/* Panels */
.panel {
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  position: relative;
}

.panel:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.panel-0 { background: var(--bg-0); }
.panel-1 { background: var(--bg-1); }
.panel-2 { background: var(--bg-2); }
.panel-3 { background: var(--bg-3); }
.panel-4 { background: var(--bg-4); }

.panel h2 {
  font-size: 1.4rem;
  color: var(--primary);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.panel h2::before {
  content: '';
  width: 6px;
  height: 24px;
  background: var(--primary);
  border-radius: 3px;
}

/* Form Elements */
.file-input {
  width: 100%;
  padding: 16px;
  border: 2px dashed rgba(0, 255, 153, 0.3);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

.file-input:hover {
  border-color: var(--primary);
  background: rgba(0, 255, 153, 0.05);
}

.file-input::file-selector-button {
  background: var(--primary);
  color: var(--bg-0);
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  margin-right: 15px;
}

.text-input {
  width: 100%;
  padding: 16px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  font-size: 16px;
  transition: all 0.3s ease;
  margin-bottom: 15px;
}

.text-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 255, 153, 0.1);
}

.btn {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--secondary), #1a3a5f);
  color: white;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(39, 76, 119, 0.3);
}

.btn:hover::after {
  left: 100%;
}

.btn:active {
  transform: translateY(0);
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), #00cc7a);
}

/* Boxes */
.box {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.box-title {
  color: var(--primary);
  font-size: 1.1rem;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Numbers Display */
.numbers-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  gap: 10px;
  margin: 15px 0;
}

.number-ball {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  font-weight: bold;
  background: linear-gradient(135deg, var(--secondary), #1a3a5f);
  color: white;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.number-ball.hot {
  background: linear-gradient(135deg, #ff6666, #cc0000);
}

.number-ball.cold {
  background: linear-gradient(135deg, #4fc3f7, #0288d1);
}

.number-ball:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
}

/* Stats */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin: 15px 0;
}

.stat-item {
  background: rgba(255, 255, 255, 0.05);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
}

.stat-label {
  color: #8da1b9;
  font-size: 0.9rem;
  margin-bottom: 5px;
}

.stat-value {
  color: var(--primary);
  font-size: 1.3rem;
  font-weight: bold;
}

/* Status Messages */
.status {
  padding: 12px;
  border-radius: 8px;
  margin: 10px 0;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.9rem;
}

.status.success {
  background: rgba(0, 255, 153, 0.1);
  border: 1px solid rgba(0, 255, 153, 0.3);
  color: var(--primary);
}

.status.warning {
  background: rgba(255, 204, 0, 0.1);
  border: 1px solid rgba(255, 204, 0, 0.3);
  color: var(--warning);
}

.status.error {
  background: rgba(255, 102, 102, 0.1);
  border: 1px solid rgba(255, 102, 102, 0.3);
  color: var(--danger);
}

/* Loading Animation */
.loading {
  display: none;
  text-align: center;
  padding: 20px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(0, 255, 153, 0.1);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 15px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Footer */
.footer {
  text-align: center;
  padding: 20px;
  color: #8da1b9;
  font-size: 0.9rem;
  margin-top: 40px;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.footer a {
  color: var(--primary);
  text-decoration: none;
}

.footer a:hover {
  text-decoration: underline;
}

/* Responsive */
@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  .header h1 {
    font-size: 2rem;
  }
  
  .panel {
    padding: 20px;
  }
  
  .numbers-grid {
    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
  }
  
  .number-ball {
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
  }
  
  .stats-row {
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 480px) {
  .stats-row {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>å¿…ä¸­ v2</h1>
    <div class="subtitle">æ™ºèƒ½é æ¸¬åˆ†æç³»çµ± | åŸºæ–¼æ­·å²æ•¸æ“šçš„å¤šç¶­åº¦åˆ†æ</div>
  </div>

  <!-- Panel 1ï¼šæ•¸æ“šå°å…¥ -->
  <div class="panel panel-1">
    <h2>ğŸ“Š æ•¸æ“šå°å…¥å±¤</h2>
    <input type="file" id="csvInput" class="file-input" accept=".csv">
    <div id="csvInfo" class="status"></div>
    <div class="stats-row" id="basicStats" style="display: none;"></div>
  </div>

  <!-- Panel Aï¼šæ™ºèƒ½åˆ†æ -->
  <div class="panel panel-2">
    <h2>ğŸ” æ™ºèƒ½åˆ†æå±¤</h2>
    <button class="btn btn-primary" onclick="runAnalysis()">åŸ·è¡Œæ·±åº¦åˆ†æ</button>
    
    <div class="loading" id="loadingA">
      <div class="spinner"></div>
      <div>æ­£åœ¨åˆ†ææ•¸æ“š...</div>
    </div>
    
    <div id="panelA" style="display: none;">
      <!-- åˆ†æçµæœå°‡å‹•æ…‹æ’å…¥ -->
    </div>
  </div>

  <!-- Panel Bï¼šçµ„åˆé©—è­‰ -->
  <div class="panel panel-3">
    <h2>âœ… çµ„åˆé©—è­‰å±¤</h2>
    <input type="text" id="verifyInput" class="text-input" placeholder="è¼¸å…¥é©—è­‰çµ„åˆï¼Œä¾‹å¦‚ï¼š1 2 16 33 35">
    <button class="btn" onclick="runVerify()">åˆ†æçµ„åˆ</button>
    
    <div id="panelB" style="display: none;">
      <!-- é©—è­‰çµæœå°‡å‹•æ…‹æ’å…¥ -->
    </div>
  </div>

  <!-- Panel Cï¼šé æ¸¬ç”Ÿæˆ -->
  <div class="panel panel-4">
    <h2>ğŸ¯ é æ¸¬ç”Ÿæˆå±¤</h2>
    <button class="btn btn-primary" onclick="generatePrediction()">ç”Ÿæˆé æ¸¬çµ„åˆ</button>
    
    <div class="loading" id="loadingC">
      <div class="spinner"></div>
      <div>æ­£åœ¨ç”Ÿæˆé æ¸¬...</div>
    </div>
    
    <div id="panelC" style="display: none;">
      <!-- é æ¸¬çµæœå°‡å‹•æ…‹æ’å…¥ -->
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç³»çµ±åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œä¸å…·ä»»ä½•é æ¸¬ä¿è­‰åŠŸèƒ½</p>
    <p>å½©ç¥¨é–‹çç‚ºéš¨æ©Ÿäº‹ä»¶ï¼Œè«‹ç†æ€§åƒèˆ‡ï¼Œé‡åŠ›è€Œè¡Œ</p>
  </div>
</div>

<script>
// å…¨å±€æ•¸æ“šå­˜å„²
let data = [];
let analysisCache = null;

// æ–‡ä»¶åŠ è¼‰
document.getElementById("csvInput").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const content = event.target.result.trim();
      const lines = content.split(/\r?\n/);
      
      data = [];
      lines.forEach((line, index) => {
        if (index === 0) return; // è·³éæ¨™é¡Œè¡Œ
        
        const parts = line.split(",");
        if (parts.length >= 6) {
          const date = parts[0].trim();
          const numbers = parts.slice(1, 6).map(num => parseInt(num.trim()));
          
          if (numbers.every(n => !isNaN(n) && n >= 1 && n <= 39)) {
            data.push({
              date: date,
              numbers: numbers
            });
          }
        }
      });
      
      if (data.length === 0) {
        showStatus("csvInfo", "æœªæ‰¾åˆ°æœ‰æ•ˆæ•¸æ“šï¼Œè«‹æª¢æŸ¥CSVæ ¼å¼", "error");
        return;
      }
      
      // é¡¯ç¤ºæ•¸æ“šä¿¡æ¯
      const info = `å·²è¼‰å…¥ ${data.length} æœŸæ•¸æ“š | æ™‚é–“ç¯„åœï¼š${data[0].date} ~ ${data[data.length-1].date}`;
      showStatus("csvInfo", info, "success");
      
      // é¡¯ç¤ºåŸºæœ¬çµ±è¨ˆ
      showBasicStats();
      
    } catch (error) {
      showStatus("csvInfo", "æ–‡ä»¶è§£æéŒ¯èª¤ï¼š" + error.message, "error");
    }
  };
  
  reader.onerror = function() {
    showStatus("csvInfo", "æ–‡ä»¶è®€å–å¤±æ•—", "error");
  };
  
  reader.readAsText(file);
});

// é¡¯ç¤ºåŸºæœ¬çµ±è¨ˆ
function showBasicStats() {
  const stats = calculateBasicStats();
  const container = document.getElementById("basicStats");
  
  container.style.display = "grid";
  container.innerHTML = `
    <div class="stat-item">
      <div class="stat-label">ç¸½æœŸæ•¸</div>
      <div class="stat-value">${stats.totalDraws}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">ç†±é–€è™Ÿç¢¼</div>
      <div class="stat-value">${stats.hotNumbers.slice(0, 3).join(", ")}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">å†·é–€è™Ÿç¢¼</div>
      <div class="stat-value">${stats.coldNumbers.slice(0, 3).join(", ")}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">å¹³å‡å’Œå€¼</div>
      <div class="stat-value">${stats.avgSum}</div>
    </div>
  `;
}

// è¨ˆç®—åŸºæœ¬çµ±è¨ˆ
function calculateBasicStats() {
  const frequency = {};
  const sums = [];
  
  // è¨ˆç®—é »ç‡
  data.forEach(draw => {
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
    });
    sums.push(draw.numbers.reduce((a, b) => a + b, 0));
  });
  
  // æ’åºè™Ÿç¢¼
  const allNumbers = Array.from({length: 39}, (_, i) => i + 1);
  const sortedNumbers = allNumbers.sort((a, b) => {
    const freqA = frequency[a] || 0;
    const freqB = frequency[b] || 0;
    return freqB - freqA;
  });
  
  const hotNumbers = sortedNumbers.slice(0, 10);
  const coldNumbers = sortedNumbers.slice(-10).reverse();
  const avgSum = Math.round(sums.reduce((a, b) => a + b, 0) / sums.length);
  
  return {
    totalDraws: data.length,
    hotNumbers,
    coldNumbers,
    avgSum
  };
}

// åŸ·è¡Œåˆ†æ
function runAnalysis() {
  if (data.length === 0) {
    alert("è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶");
    return;
  }
  
  showLoading("loadingA", true);
  
  // æ¨¡æ“¬åˆ†æéç¨‹
  setTimeout(() => {
    const stats = calculateAdvancedStats();
    displayAnalysisResults(stats);
    showLoading("loadingA", false);
  }, 1000);
}

// è¨ˆç®—é€²éšçµ±è¨ˆ
function calculateAdvancedStats() {
  const frequency = {};
  const lastSeen = {};
  const sumStats = {
    sums: [],
    min: Infinity,
    max: -Infinity
  };
  
  // æ”¶é›†æ•¸æ“š
  data.forEach((draw, index) => {
    // é »ç‡å’Œæœ€å¾Œå‡ºç¾ä½ç½®
    draw.numbers.forEach(num => {
      frequency[num] = (frequency[num] || 0) + 1;
      lastSeen[num] = index;
    });
    
    // å’Œå€¼çµ±è¨ˆ
    const sum = draw.numbers.reduce((a, b) => a + b, 0);
    sumStats.sums.push(sum);
    sumStats.min = Math.min(sumStats.min, sum);
    sumStats.max = Math.max(sumStats.max, sum);
  });
  
  // è¨ˆç®—å¹³å‡å’Œå€¼
  sumStats.avg = Math.round(sumStats.sums.reduce((a, b) => a + b, 0) / sumStats.sums.length);
  
  // è¨ˆç®—æ¨™æº–å·®
  const variance = sumStats.sums.reduce((acc, sum) => acc + Math.pow(sum - sumStats.avg, 2), 0) / sumStats.sums.length;
  sumStats.stdDev = Math.round(Math.sqrt(variance));
  
  // è¨ˆç®—å¥‡å¶æ¯”æ­·å²
  const oddRatios = data.map(draw => {
    const oddCount = draw.numbers.filter(n => n % 2 === 1).length;
    return { odd: oddCount, even: 5 - oddCount };
  });
  
  const avgOdd = Math.round(oddRatios.reduce((acc, r) => acc + r.odd, 0) / oddRatios.length);
  
  // è­˜åˆ¥æ½›åœ¨è™Ÿç¢¼æ± 
  const T = data.length;
  const potentialNumbers = [];
  
  for (let num = 1; num <= 39; num++) {
    const freq = frequency[num] || 0;
    const freqRatio = freq / T;
    const daysSince = T - (lastSeen[num] || 0);
    
    // ç¯©é¸æ¢ä»¶ï¼šå‡ºç¾é »ç‡é©ä¸­ï¼Œæœ€è¿‘å‡ºç¾éä½†ä¸æ˜¯å¤ªè¿‘
    if (freqRatio > 0.03 && freqRatio < 0.15 && daysSince > 5 && daysSince < 30) {
      potentialNumbers.push({
        num,
        freq: freqRatio.toFixed(3),
        daysSince
      });
    }
  }
  
  // æŒ‰å¤©æ•¸æ’åº
  potentialNumbers.sort((a, b) => a.daysSince - b.daysSince);
  
  return {
    frequency,
    lastSeen,
    sumStats,
    potentialNumbers,
    avgOdd,
    totalDraws: T
  };
}

// é¡¯ç¤ºåˆ†æçµæœ
function displayAnalysisResults(stats) {
  const container = document.getElementById("panelA");
  container.style.display = "block";
  analysisCache = stats;
  
  // ç†±é–€è™Ÿç¢¼
  const hotNumbers = Object.entries(stats.frequency)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 10)
    .map(([num]) => parseInt(num));
  
  // å†·é–€è™Ÿç¢¼
  const coldNumbers = Object.entries(stats.frequency)
    .sort(([,a], [,b]) => a - b)
    .slice(0, 10)
    .map(([num]) => parseInt(num));
  
  // éºæ¼è™Ÿç¢¼
  const missedNumbers = Array.from({length: 39}, (_, i) => i + 1)
    .filter(num => stats.lastSeen[num] === undefined || 
                   (data.length - stats.lastSeen[num]) > 20)
    .slice(0, 10);
  
  let html = `
    <div class="box">
      <div class="box-title">ğŸ”¥ ç†±é–€è™Ÿç¢¼ï¼ˆå‡ºç¾é »ç‡æœ€é«˜ï¼‰</div>
      <div class="numbers-grid">
        ${hotNumbers.map(num => `<div class="number-ball hot">${num}</div>`).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â„ï¸ å†·é–€è™Ÿç¢¼ï¼ˆå‡ºç¾é »ç‡æœ€ä½ï¼‰</div>
      <div class="numbers-grid">
        ${coldNumbers.map(num => `<div class="number-ball cold">${num}</div>`).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â³ é•·æœŸéºæ¼è™Ÿç¢¼</div>
      <div class="numbers-grid">
        ${missedNumbers.map(num => `<div class="number-ball">${num}</div>`).join('')}
      </div>
      <div class="status warning">é€™äº›è™Ÿç¢¼å·²è¶…é20æœŸæœªå‡ºç¾</div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“ˆ å’Œå€¼çµ±è¨ˆåˆ†æ</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å’Œå€¼</div>
          <div class="stat-value">${stats.sumStats.avg}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å°å’Œå€¼</div>
          <div class="stat-value">${stats.sumStats.min}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å¤§å’Œå€¼</div>
          <div class="stat-value">${stats.sumStats.max}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ¨™æº–å·®</div>
          <div class="stat-value">${stats.sumStats.stdDev}</div>
        </div>
      </div>
      <div class="status info">å»ºè­°å’Œå€¼ç¯„åœï¼š${stats.sumStats.avg - 15} ~ ${stats.sumStats.avg + 15}</div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ¯ æ½›åœ¨è™Ÿç¢¼æ± ï¼ˆ${stats.potentialNumbers.length}å€‹ï¼‰</div>
      <div class="numbers-grid">
        ${stats.potentialNumbers.slice(0, 20).map(item => 
          `<div class="number-ball" title="é »ç‡: ${item.freq} | éºæ¼: ${item.daysSince}æœŸ">${item.num}</div>`
        ).join('')}
      </div>
      ${stats.potentialNumbers.length > 20 ? 
        `<div class="status">... é‚„æœ‰ ${stats.potentialNumbers.length - 20} å€‹è™Ÿç¢¼</div>` : ''}
    </div>
  `;
  
  container.innerHTML = html;
}

// çµ„åˆé©—è­‰
function runVerify() {
  const input = document.getElementById("verifyInput").value.trim();
  if (!input) {
    alert("è«‹è¼¸å…¥è¦é©—è­‰çš„è™Ÿç¢¼çµ„åˆ");
    return;
  }
  
  const numbers = input.split(/\s+/).map(num => parseInt(num.trim()));
  
  if (numbers.length !== 5 || numbers.some(n => isNaN(n) || n < 1 || n > 39)) {
    alert("è«‹è¼¸å…¥5å€‹æœ‰æ•ˆçš„è™Ÿç¢¼ï¼ˆ1-39ä¹‹é–“ï¼‰");
    return;
  }
  
  if (new Set(numbers).size !== 5) {
    alert("è™Ÿç¢¼ä¸èƒ½é‡è¤‡");
    return;
  }
  
  const container = document.getElementById("panelB");
  container.style.display = "block";
  
  if (!analysisCache) {
    analysisCache = calculateAdvancedStats();
  }
  
  const stats = analysisCache;
  const sortedNumbers = [...numbers].sort((a, b) => a - b);
  
  // è¨ˆç®—çµ„åˆç‰¹æ€§
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const sum = numbers.reduce((a, b) => a + b, 0);
  const span = Math.max(...numbers) - Math.min(...numbers);
  const avgOdd = stats.avgOdd;
  
  // è©•ä¼°æ¯å€‹è™Ÿç¢¼
  const numberAssessments = numbers.map(num => {
    const freq = stats.frequency[num] || 0;
    const freqRatio = (freq / stats.totalDraws).toFixed(3);
    const daysSince = stats.totalDraws - (stats.lastSeen[num] || 0);
    
    let status = "neutral";
    let statusText = "ä¸€èˆ¬";
    
    if (freqRatio > 0.12) {
      status = "hot";
      statusText = "ç†±é–€";
    } else if (freqRatio < 0.05) {
      status = "cold";
      statusText = "å†·é–€";
    }
    
    if (daysSince > 20) {
      status = "missed";
      statusText = "é•·æœŸéºæ¼";
    }
    
    return { num, freqRatio, daysSince, status, statusText };
  });
  
  // æ•´é«”è©•ä¼°
  let overallStatus = "success";
  let overallMessage = "é€™æ˜¯ä¸€å€‹åˆç†çš„çµ„åˆ";
  
  // æª¢æŸ¥å¥‡å¶æ¯”
  if (Math.abs(oddCount - avgOdd) > 2) {
    overallStatus = "warning";
    overallMessage = "å¥‡å¶æ¯”ä¾‹èˆ‡æ­·å²è¶¨å‹¢å·®ç•°è¼ƒå¤§";
  }
  
  // æª¢æŸ¥å’Œå€¼
  if (sum < stats.sumStats.min || sum > stats.sumStats.max) {
    overallStatus = "warning";
    overallMessage = "å’Œå€¼è¶…å‡ºæ­·å²ç¯„åœ";
  }
  
  // æª¢æŸ¥è·¨åº¦
  if (span < 15) {
    overallStatus = "warning";
    overallMessage = "è™Ÿç¢¼è·¨åº¦åå°";
  }
  
  let html = `
    <div class="box">
      <div class="box-title">ğŸ“‹ çµ„åˆé©—è­‰çµæœ</div>
      
      <div class="numbers-grid">
        ${sortedNumbers.map(num => `<div class="number-ball">${num}</div>`).join('')}
      </div>
      
      <div class="status ${overallStatus}">${overallMessage}</div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶æ¯”ä¾‹</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼è·¨åº¦</div>
          <div class="stat-value">${span}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å¥‡æ•¸</div>
          <div class="stat-value">${avgOdd}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ” å€‹åˆ¥è™Ÿç¢¼åˆ†æ</div>
      ${numberAssessments.map(item => `
        <div class="stat-item" style="text-align: left; margin-bottom: 10px;">
          <div><strong>è™Ÿç¢¼ ${item.num}</strong></div>
          <div style="font-size: 0.9rem; color: #8da1b9;">
            å‡ºç¾é »ç‡ï¼š${item.freqRatio} | 
            éºæ¼æœŸæ•¸ï¼š${item.daysSince} | 
            ç‹€æ…‹ï¼š<span style="color: ${getStatusColor(item.status)}">${item.statusText}</span>
          </div>
        </div>
      `).join('')}
    </div>
  `;
  
  container.innerHTML = html;
}

// ç”Ÿæˆé æ¸¬
function generatePrediction() {
  if (data.length === 0) {
    alert("è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶");
    return;
  }
  
  showLoading("loadingC", true);
  
  setTimeout(() => {
    if (!analysisCache) {
      analysisCache = calculateAdvancedStats();
    }
    
    const prediction = generatePredictionNumbers(analysisCache);
    displayPrediction(prediction);
    showLoading("loadingC", false);
  }, 800);
}

// ç”Ÿæˆé æ¸¬è™Ÿç¢¼
function generatePredictionNumbers(stats) {
  const { frequency, lastSeen, totalDraws, sumStats, avgOdd } = stats;
  
  // ç¬¬ä¸€æ­¥ï¼šé¸æ“‡æ½›åœ¨è™Ÿç¢¼æ± 
  let candidates = [];
  
  for (let num = 1; num <= 39; num++) {
    const freq = frequency[num] || 0;
    const freqRatio = freq / totalDraws;
    const daysSince = totalDraws - (lastSeen[num] || 0);
    
    // ç¶œåˆè©•åˆ†å…¬å¼
    let score = 0;
    
    // é »ç‡å› ç´ ï¼šä¸­ç­‰é »ç‡è¼ƒå¥½
    if (freqRatio > 0.05 && freqRatio < 0.12) score += 30;
    else if (freqRatio >= 0.12) score += 20;
    else score += 10;
    
    // éºæ¼å› ç´ ï¼šé©åº¦éºæ¼è¼ƒå¥½
    if (daysSince > 10 && daysSince < 25) score += 40;
    else if (daysSince >= 25) score += 50; // é•·æœŸéºæ¼åŠ åˆ†
    else if (daysSince <= 5) score += 10; // æœ€è¿‘å‰›å‡ºæ¸›åˆ†
    
    // å¥‡å¶å¹³è¡¡è€ƒæ…®
    if (num % 2 === 1) score += 5; // ç¨å¾®åå¥½å¥‡æ•¸
    
    candidates.push({ num, score, freqRatio, daysSince });
  }
  
  // æŒ‰åˆ†æ•¸æ’åº
  candidates.sort((a, b) => b.score - a.score);
  
  // ç¬¬äºŒæ­¥ï¼šå¾é«˜åˆ†ä¸­é¸æ“‡ï¼Œç¢ºä¿å¤šæ¨£æ€§
  const selected = [];
  const usedNumbers = new Set();
  
  // ç¢ºä¿å¥‡å¶å¹³è¡¡
  let oddCount = 0;
  const targetOddCount = avgOdd;
  
  for (let candidate of candidates) {
    if (selected.length >= 5) break;
    
    // è·³éå·²é¸è™Ÿç¢¼
    if (usedNumbers.has(candidate.num)) continue;
    
    // æª¢æŸ¥å¥‡å¶å¹³è¡¡
    const isOdd = candidate.num % 2 === 1;
    if (isOdd && oddCount >= targetOddCount) continue;
    if (!isOdd && (5 - selected.length - oddCount) < (5 - targetOddCount)) continue;
    
    // æª¢æŸ¥è·¨åº¦ï¼ˆé¿å…å¤ªé›†ä¸­ï¼‰
    if (selected.length >= 2) {
      const temp = [...selected, candidate.num].sort((a, b) => a - b);
      const span = temp[temp.length-1] - temp[0];
      if (span < 10 && selected.length < 4) continue;
    }
    
    // æª¢æŸ¥å’Œå€¼ç¯„åœ
    const tempSum = [...selected, candidate.num].reduce((a, b) => a + b, 0);
    if (selected.length === 4) {
      const expectedSum = Math.round(sumStats.avg);
      if (Math.abs(tempSum - expectedSum) > 30) continue;
    }
    
    // é€šéæ‰€æœ‰æª¢æŸ¥ï¼ŒåŠ å…¥é¸æ“‡
    selected.push(candidate.num);
    usedNumbers.add(candidate.num);
    if (isOdd) oddCount++;
  }
  
  // å¦‚æœä¸å¤ 5å€‹ï¼Œè£œé½Š
  while (selected.length < 5) {
    for (let i = 1; i <= 39; i++) {
      if (!usedNumbers.has(i)) {
        selected.push(i);
        usedNumbers.add(i);
        break;
      }
    }
  }
  
  // æ’åºæœ€çµ‚çµæœ
  return selected.sort((a, b) => a - b);
}

// é¡¯ç¤ºé æ¸¬çµæœ
function displayPrediction(numbers) {
  const container = document.getElementById("panelC");
  container.style.display = "block";
  
  const oddCount = numbers.filter(n => n % 2 === 1).length;
  const sum = numbers.reduce((a, b) => a + b, 0);
  const span = Math.max(...numbers) - Math.min(...numbers);
  const avg = sum / 5;
  
  let html = `
    <div class="box">
      <div class="box-title">ğŸ¯ æ™ºèƒ½é æ¸¬çµ„åˆ</div>
      
      <div class="numbers-grid">
        ${numbers.map(num => `<div class="number-ball" style="background: linear-gradient(135deg, #00ff99, #00cc7a);">${num}</div>`).join('')}
      </div>
      
      <div class="status success">âœ… åŸºæ–¼æ­·å²æ•¸æ“šçš„æ™ºèƒ½é æ¸¬çµ„åˆ</div>
      
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶æ¯”ä¾‹</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡è™Ÿç¢¼</div>
          <div class="stat-value">${avg.toFixed(1)}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼è·¨åº¦</div>
          <div class="stat-value">${span}</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“Š çµ„åˆç‰¹æ€§åˆ†æ</div>
      
      <div style="margin: 15px 0;">
        <div style="margin-bottom: 10px;">
          <strong>å¥‡å¶å¹³è¡¡ï¼š</strong>
          <span style="color: ${Math.abs(oddCount - 2) <= 1 ? '#00ff99' : '#ffcc00'}">
            ${oddCount === 2 || oddCount === 3 ? 'è‰¯å¥½' : 'å°šå¯'}
          </span>
        </div>
        
        <div style="margin-bottom: 10px;">
          <strong>è™Ÿç¢¼åˆ†ä½ˆï¼š</strong>
          <span style="color: ${span >= 20 ? '#00ff99' : '#ffcc00'}">
            ${span >= 20 ? 'åˆ†æ•£è‰¯å¥½' : 'è¼ƒç‚ºé›†ä¸­'}
          </span>
        </div>
        
        <div style="margin-bottom: 10px;">
          <strong>å’Œå€¼åˆç†æ€§ï¼š</strong>
          <span style="color: ${sum >= 80 && sum <= 150 ? '#00ff99' : '#ffcc00'}">
            ${sum >= 80 && sum <= 150 ? 'åˆç†ç¯„åœ' : 'åé›¢å¸¸è¦'}
          </span>
        </div>
      </div>
      
      <div class="status warning">
        ğŸ’¡ æç¤ºï¼šå»ºè­°å°‡æ­¤çµ„åˆèˆ‡å…¶ä»–ç­–ç•¥çµæœçµåˆåƒè€ƒ
      </div>
    </div>
  `;
  
  container.innerHTML = html;
}

// å·¥å…·å‡½æ•¸
function showStatus(elementId, message, type = "info") {
  const element = document.getElementById(elementId);
  element.innerHTML = `<div class="status ${type}">${message}</div>`;
}

function showLoading(loadingId, show) {
  const element = document.getElementById(loadingId);
  element.style.display = show ? "block" : "none";
}

function getStatusColor(status) {
  switch(status) {
    case "hot": return "#ff6666";
    case "cold": return "#4fc3f7";
    case "missed": return "#ffcc00";
    default: return "#8da1b9";
  }
}

// åˆå§‹åŒ–é é¢
document.addEventListener('DOMContentLoaded', function() {
  // æ·»åŠ æ–‡ä»¶æ‹–æ”¾æ”¯æŒ
  const fileInput = document.getElementById('csvInput');
  const panel1 = document.querySelector('.panel-1');
  
  panel1.addEventListener('dragover', function(e) {
    e.preventDefault();
    panel1.style.borderColor = '#00ff99';
  });
  
  panel1.addEventListener('dragleave', function(e) {
    e.preventDefault();
    panel1.style.borderColor = 'rgba(255, 255, 255, 0.05)';
  });
  
  panel1.addEventListener('drop', function(e) {
    e.preventDefault();
    panel1.style.borderColor = 'rgba(255, 255, 255, 0.05)';
    
    if (e.dataTransfer.files.length) {
      fileInput.files = e.dataTransfer.files;
      fileInput.dispatchEvent(new Event('change'));
    }
  });
});
</script>
</body>
</html>
