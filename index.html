<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Office Royale: Extreme Edition</title>
    <style>
        /* çš‡å®¤æˆ°çˆ­è³ªæ„Ÿ UI èƒŒæ™¯ */
        body { 
            margin: 0; overflow: hidden; background: #1a1a1d; 
            display: flex; justify-content: center; align-items: center; height: 100vh; 
            [cite_start]font-family: 'Arial', sans-serif; [cite: 2]
        }
        
        #game-container { 
            position: relative; border: 6px solid #4e342e; border-radius: 20px; 
            [cite_start]overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); [cite: 4]
        }
        
        /* é ‚éƒ¨è³‡è¨Šåˆ—ï¼šçš‡å®¤æœ¨ç´‹é¢¨ */
        #ui-header { 
            position: absolute; top: 0; width: 100%; height: 50px; 
            background: linear-gradient(to bottom, #8d6e63, #3e2723);
            display: flex; justify-content: space-between; align-items: center; 
            [cite_start]padding: 0 15px; box-sizing: border-box; border-bottom: 3px solid #2d1b18; z-index: 10; [cite: 6, 7]
        }

        .day-badge {
            background: #f44336; color: white; padding: 2px 12px;
            border-radius: 8px; border: 2px solid #ffc107;
            [cite_start]font-weight: 900; font-size: 18px; box-shadow: 0 3px 0 #b71c1c; [cite: 8, 9]
        }

        /* è–æ°´èƒ½é‡æ¢ï¼šç¶“å…¸ç²‰è‰²è¨ˆé‡æ„Ÿ */
        #elixir-container {
            position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 80%; height: 12px; background: #263238;
            [cite_start]border-radius: 10px; border: 2px solid #546e7a; z-index: 10; [cite: 10, 11]
        }
        #elixir-bar { 
            width: 0%; height: 100%; 
            background: linear-gradient(90deg, #ea80fc, #e040fb); 
            border-radius: 5px; transition: width 0.1s linear; 
        }

        [cite_start]canvas { background: #78909c; display: block; touch-action: none; [cite: 13] }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-header">
        <div class="day-badge">DAY <span id="day-val">1</span> / 30</div>
        <div style="color: #fff; font-size: 12px; font-weight: bold;">PROG: <span id="prog-val">0</span>/2</div>
    </div>
    <div id="elixir-container"><div id="elixir-bar"></div></div>
    <canvas id="game"></canvas>
</div>

<script>
const canvas = document.getElementById('game');
[cite_start]const ctx = canvas.getContext('2d'); [cite: 14]
canvas.width = 360; canvas.height = 640;

// ç´ æè³‡æº (Emoji è¡¨æƒ…åœ–ç‰‡)
const IMG_SRC = {
    me: 'https://openmoji.org/data/color/svg/1F3C3.svg', // è·‘è€…
    boss: 'https://openmoji.org/data/color/svg/1F47A.svg', // ğŸ˜ˆ ä¸»ç®¡
    edit: 'https://openmoji.org/data/color/svg/1F4DC.svg', // ğŸ“œ æ”¹ç¨¿
    meet: 'https://openmoji.org/data/color/svg/23F0.svg'  // â° æœƒè­°
};

const imgs = {};
Object.entries(IMG_SRC).forEach(([k, src]) => {
    imgs[k] = new Image();
    imgs[k].src = src;
});

const CFG = {
    [cite_start]P_SPD: 850, // ç©å®¶é€Ÿåº¦ [cite: 15]
    E_TYPES: [
        { n: 'ä¸»ç®¡', c: '#ff5252', s: 1000, sz: 65, img: 'boss' },
        { n: 'æ”¹ç¨¿', c: '#ffab40', s: 1500, sz: 55, img: 'edit' },
        { n: 'æœƒè­°', c: '#ffd740', s: 2300, sz: 45, img: 'meet' }
    ],
    [cite_start]AMBUSH_SPD: 2500 // æ””æˆªé€Ÿåº¦ [cite: 15]
};

[cite_start]let day = 1, progress = 0, isPaused = false, lastT = performance.now(); [cite: 16]
[cite_start]let player = { x: 150, y: 530, w: 60, h: 60, isFiring: false }; [cite: 17]
let elixir = 100; // è–æ°´å€¼
let enemies = [];

[cite_start]const audio = new (window.AudioContext || window.webkitAudioContext)(); [cite: 18]
function playSound(f, t, d) {
    if(audio.state === 'suspended') audio.resume();
    [cite_start]const o = audio.createOscillator(), g = audio.createGain(); [cite: 19]
    o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
    g.gain.setValueAtTime(0.1, audio.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + d);
    o.connect(g); g.connect(audio.destination);
    [cite_start]o.start(); o.stop(audio.currentTime + d); [cite: 20]
}

function spawn(isAmbush = false, sideInput = null) {
    const type = isAmbush ? [cite_start]CFG.E_TYPES[2] : CFG.E_TYPES[Math.floor(Math.random()*3)]; [cite: 21]
    const side = sideInput || (Math.random() > 0.5 ? 1 : -1);
    enemies.push({
        x: side === 1 ? -120 : 480,
        y: 100 + Math.random() * 320,
        vx: (isAmbush ? CFG.AMBUSH_SPD : type.s) * side,
        [cite_start]vVar: Math.random() * 5, // å¿½å¿«å¿½æ…¢æ“¾å‹•å€¼ [cite: 22]
        ...type
    });
}

setInterval(() => { if(!isPaused && !player.isFiring) spawn(); }, 300);

function update(dt) {
    if (isPaused) return;

    // è–æ°´æ¢å¾©é‚è¼¯ (ç™¼å°„å¾Œéœ€ç­‰å¾…å……èƒ½)
    if (!player.isFiring) {
        elixir = Math.min(100, elixir + dt * 45); 
    } else {
        elixir = 0;
    }
    document.getElementById('elixir-bar').style.width = elixir + '%';

    if (player.isFiring) {
        [cite_start]player.y -= CFG.P_SPD * dt; [cite: 24]
        [cite_start]if (player.y < 50) { [cite: 25]
            progress++;
            playSound(1000, 'sine', 0.2);
            if (progress >= 2) { day++; progress = 0; [cite_start]} [cite: 26]
            reset();
        }
    }

    enemies.forEach((e, i) => {
        [cite_start]// å¿½å¿«å¿½æ…¢æ•ˆæœï¼šå‹•æ…‹é€Ÿåº¦æ“¾å‹• [cite: 28]
        const wave = Math.sin(Date.now() / 200 + e.vVar) * 120;
        e.x += (e.vx + wave) * dt;

        // ç¢°æ’åµæ¸¬ (å¾®èª¿åˆ¤å®šç¯„åœæ›´ç²¾æº–)
        if (player.isFiring && player.x < e.x + e.sz - 10 && player.x + player.w > e.x + 10 && 
            player.y < e.y + e.sz - 10 && player.y + player.h > e.y + 10) {
            [cite_start]playSound(150, 'square', 0.3); [cite: 28]
            reset();
        }
        if (e.x < -300 || e.x > 660) enemies.splice(i, 1);
    });

    [cite_start]document.getElementById('day-val').innerText = day; [cite: 29]
    document.getElementById('prog-val').innerText = progress;
    document.getElementById('progress-bar').style.width = (progress / 2) * 100 + "%";
}

function reset() { 
    player.y = 530; 
    [cite_start]player.isFiring = false; [cite: 30]
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    [cite_start]// è¾¦å…¬å®¤é¦¬è·¯èƒŒæ™¯ [cite: 31]
    ctx.fillStyle = "#607d8b"; // åœ°æ¯¯ç°è‰²
    ctx.fillRect(0,0,360,640);
    
    [cite_start]// åˆ†é“ç·š [cite: 32, 33]
    ctx.strokeStyle = "rgba(255,255,255,0.3)";
    ctx.lineWidth = 4;
    ctx.setLineDash([20, 20]);
    ctx.beginPath(); ctx.moveTo(120,0); ctx.lineTo(120,640); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(240,0); ctx.lineTo(240,640); ctx.stroke();
    ctx.setLineDash([]);

    // æ•µäººç¹ªè£½ (Emoji + å¡ç‰Œé™°å½±)
    enemies.forEach(e => {
        // åœ°é¢é™°å½±
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.beginPath(); ctx.ellipse(e.x + e.sz/2, e.y + e.sz, e.sz/2, 10, 0, 0, Math.PI*2); ctx.fill();
        
        // è§’è‰²åœ–åƒç¹ªè£½
        if(imgs[e.img]) {
            ctx.drawImage(imgs[e.img], e.x, e.y, e.sz, e.sz);
        }

        // è¡€æ¢è£é£¾æ„Ÿ (çš‡å®¤å–®ä½ç‰¹å¾µ)
        ctx.fillStyle = "#333"; ctx.fillRect(e.x, e.y - 12, e.sz, 6);
        ctx.fillStyle = e.c; ctx.fillRect(e.x, e.y - 12, e.sz * 0.8, 6);
    });

    [cite_start]// ç©å®¶ç¹ªè£½ [cite: 35, 36]
    ctx.fillStyle = "rgba(0,0,0,0.2)";
    ctx.beginPath(); ctx.ellipse(player.x + player.w/2, player.y + player.h, player.w/2, 10, 0, 0, Math.PI*2); ctx.fill();
    
    if(imgs.me) {
        ctx.drawImage(imgs.me, player.x, player.y, player.w, player.h);
    }
    
    [cite_start]// å½ˆå°„è–æ°´ç‰¹æ•ˆ [cite: 38, 39]
    if(player.isFiring) {
        ctx.shadowBlur = 15;
        ctx.shadowColor = "#00bcd4";
        ctx.fillStyle = "rgba(0, 188, 212, 0.4)";
        ctx.fillRect(player.x, player.y + player.h, player.w, 15);
        ctx.shadowBlur = 0;
    }
}

function loop(t) {
    let dt = (t - lastT) / 1000;
    lastT = t;
    [cite_start]update(dt > 0.1 ? 0 : dt); [cite: 40]
    draw();
    requestAnimationFrame(loop);
}

const launch = () => {
    // åªæœ‰è–æ°´å……æ»¿ä¸”æœªåœ¨å°„æ“Šæ™‚æ‰å¯ç™¼å‹•
    if(!player.isFiring && !isPaused && elixir >= 95) {
        player.isFiring = true;
        [cite_start]playSound(600, 'triangle', 0.1); [cite: 41]
        
        [cite_start]// éš±è—æ©Ÿåˆ¶ï¼šç™¼å°„æ™‚ 40% æ©Ÿç‡å½ˆå‡ºå…©å´é«˜é€Ÿæ•µäºº [cite: 41]
        if(Math.random() < 0.4) {
            [cite_start]const m = Math.floor(Math.random()*3); [cite: 42]
            if(m===0){ spawn(true, 1); spawn(true, 1); }
            else if(m===1){ spawn(true, -1); spawn(true, -1); }
            else { spawn(true, 1); spawn(true, -1); [cite_start]} [cite: 43, 44]
        }
    }
};

canvas.addEventListener('mousedown', launch);
[cite_start]canvas.addEventListener('touchstart', (e) => { e.preventDefault(); launch(); }); [cite: 45]
requestAnimationFrame(loop);
</script>
</body>
</html>
