<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>數據驗證與預測</title>
    <style>
        :root { --ios-blue: #007AFF; --ios-green: #34C759; --ios-bg: #F2F2F7; }
        body { font-family: -apple-system, sans-serif; background: var(--ios-bg); margin: 0; padding: 15px; color: #1C1C1E; }
        .section { background: white; border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; font-size: 17px; border-bottom: 1px solid #EEE; padding-bottom: 8px; }
        
        /* 按鈕設計 */
        .btn { background: var(--ios-blue); color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-size: 16px; font-weight: 600; margin-top: 10px; }
        .btn:active { opacity: 0.7; }
        .btn-predict { background: var(--ios-green); }

        /* 卡片設計 */
        .card { background: #F8F8FA; border-radius: 8px; padding: 12px; margin-top: 10px; border-left: 4px solid var(--ios-blue); }
        .num-badge { display: inline-block; background: var(--ios-blue); color: white; padding: 4px 10px; border-radius: 20px; font-weight: bold; margin-right: 5px; }
        
        /* 預測顯示區 */
        #predictionResult { display: flex; justify-content: space-around; margin-top: 15px; }
        .predict-num { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--ios-green); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--ios-green); background: #EFFFF4; }
    </style>
</head>
<body>

    <div class="section">
        <h3>1. 數據分析與驗證</h3>
        <input type="file" id="csvInput" accept=".csv">
        <div id="verifyPanel"></div>
    </div>

    <div class="section">
        <h3>2. 號碼生成面板</h3>
        <p style="font-size: 13px; color: #666;">依據 CSV 熱門權重計算下一組建議值</p>
        <button class="btn btn-predict" onclick="generateNumbers()">產生下期建議號碼</button>
        <div id="predictionResult">
            </div>
    </div>

    <script>
        let globalData = [];
        const targets = [1, 33, 16, 35, 2];

        document.getElementById('csvInput').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const lines = event.target.result.split('\n').filter(l => l.trim() !== '');
                globalData = lines.map(line => line.split(',').map(v => parseFloat(v.trim())));
                runVerification();
            };
            reader.readAsText(e.target.files[0]);
        });

        // 邏輯驗證：找出 1, 33, 16, 35, 2 的來源
        function runVerification() {
            const panel = document.getElementById('verifyPanel');
            panel.innerHTML = '';
            
            targets.forEach(t => {
                let logic = "規律分析中...";
                for (let col = 0; col < globalData[0].length; col++) {
                    const colValues = globalData.map(r => r[col]).filter(v => !isNaN(v));
                    if (Math.max(...colValues) === t) logic = `第 ${col+1} 欄的最大值`;
                    else if (colValues[colValues.length-1] === t) logic = `第 ${col+1} 欄的最新落球`;
                }
                panel.innerHTML += `<div class="card"><span class="num-badge">${t}</span> 邏輯: ${logic}</div>`;
            });
        }

        // 下期產出：根據出現頻率最高的號碼推薦
        function generateNumbers() {
            if (globalData.length === 0) { alert('請先上傳 CSV 檔案'); return; }
            
            const resultDiv = document.getElementById('predictionResult');
            resultDiv.innerHTML = '';

            // 簡易演算法：計算全表出現頻率
            const flatData = globalData.flat().filter(v => !isNaN(v));
            const freq = {};
            flatData.forEach(v => freq[v] = (freq[v] || 0) + 1);
            
            // 排序並取前 5 名
            const sorted = Object.keys(freq).sort((a, b) => freq[b] - freq[a]).slice(0, 5);

            sorted.forEach(n => {
                resultDiv.innerHTML += `<div class="predict-num">${n}</div>`;
            });
        }
    </script>
</body>
</html>
