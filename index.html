<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>逃離生活 - Escape Life</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #222; overflow: hidden; touch-action: none; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
        #game-container { border: 4px solid #333; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <div id="game-container"></div>

<script>
const config = {
    type: Phaser.AUTO,
    width: 360,
    height: 640,
    parent: 'game-container',
    physics: {
        default: 'arcade',
        arcade: { debug: false }
    },
    scene: { preload, create, update }
};

const game = new Phaser.Game(config);

let player, enemies, scoreText;
let score = 0;
let isGameOver = false;
const enemyNames = ['老闆', '房貸', '車貸', '主管', '老婆', 'KPI', '加班'];

function preload() {
    // 這裡使用我為您準備的「逃離之路」背景圖 (Base64)
    // 這樣可以避免圖片載入失敗的問題
    this.load.image('bg', 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&q=60&w=400&ixlib=rb-4.0.3');
}

function create() {
    // 背景設定
    let bg = this.add.image(180, 320, 'bg').setDisplaySize(360, 640).setAlpha(0.6);
    
    // 簡單的馬路效果
    let road = this.add.rectangle(180, 320, 280, 640, 0x333333).setAlpha(0.8);

    // 玩家 (社畜)
    player = this.add.container(180, 550);
    let playerBody = this.add.rectangle(0, 0, 40, 50, 0xffcc00);
    let playerText = this.add.text(-15, -10, '社畜', { fontSize: '14px', fill: '#000', fontWeight: 'bold' });
    player.add([playerBody, playerText]);
    
    this.physics.add.existing(player);
    player.body.setCollideWorldBounds(true);

    // 敵人群組
    enemies = this.physics.add.group();

    // 計分板
    scoreText = this.add.text(20, 20, '逃離值: 0', { 
        fontSize: '24px', 
        fill: '#fff', 
        backgroundColor: '#000000aa',
        padding: { x: 10, y: 5 }
    }).setDepth(10);

    // 生成敵人計時器
    this.time.addEvent({
        delay: 800,
        callback: spawnEnemy,
        callbackScope: this,
        loop: true
    });

    // 碰撞偵測
    this.physics.add.overlap(player, enemies, hitEnemy, null, this);

    // 控制 (PC + iOS)
    this.input.on('pointermove', (pointer) => {
        if (!isGameOver) {
            // 平滑跟隨手指或滑鼠位置
            this.tweens.add({
                targets: player,
                x: Phaser.Math.Clamp(pointer.x, 60, 300),
                duration: 100
            });
        }
    });

    // 針對手機點擊重玩
    this.input.on('pointerdown', () => {
        if (isGameOver) window.location.reload();
    });
}

function update() {
    if (isGameOver) return;
    score += 1;
    scoreText.setText('逃離值: ' + Math.floor(score/10));
}

function spawnEnemy() {
    if (isGameOver) return;

    let x = Phaser.Math.Between(60, 300);
    let name = enemyNames[Phaser.Math.Between(0, enemyNames.length - 1)];
    
    let container = this.add.container(x, -50);
    let box = this.add.rectangle(0, 0, 70, 40, 0xff4444);
    let txt = this.add.text(-25, -10, name, { fontSize: '16px', fill: '#fff' });
    container.add([box, txt]);

    enemies.add(container);
    this.physics.add.existing(container);
    
    // 設定敵人向下衝的速度，隨分數增加
    container.body.setVelocityY(200 + (score/20));
    
    // 增加一點點左右晃動，模擬生活的不穩定感
    this.tweens.add({
        targets: container,
        x: container.x + (Math.random() > 0.5 ? 20 : -20),
        duration: 1000,
        yoyo: true,
        repeat: -1
    });
}

function hitEnemy() {
    isGameOver = true;
    this.physics.pause();
    player.setAlpha(0.3);

    this.add.rectangle(180, 320, 360, 640, 0x000000, 0.7).setDepth(20);
    this.add.text(180, 300, '你被現實抓住了！', { fontSize: '32px', fill: '#ff0000', fontWeight: 'bold' }).setOrigin(0.5).setDepth(21);
    this.add.text(180, 360, '點擊畫面重新投胎', { fontSize: '20px', fill: '#fff' }).setOrigin(0.5).setDepth(21);
}
</script>
</body>
</html>
