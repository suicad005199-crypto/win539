<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¤¾ç•œè„«é€ƒæ—¥è¨˜ï¼š30å¤©é›¢è·æŒ‘æˆ°</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'PingFang TC', sans-serif; touch-action: manipulation; }
        canvas { background: #87CEEB; border-radius: 8px; }
        #ui { position: absolute; top: 20px; width: 320px; display: flex; justify-content: space-between; color: white; text-shadow: 1px 1px 2px #000; pointer-events: none; }
        #msg-box { position: absolute; top: 40%; width: 80%; background: rgba(0,0,0,0.8); color: #fff; padding: 20px; border-radius: 15px; text-align: center; display: none; font-size: 1.2rem; border: 2px solid gold; }
    </style>
</head>
<body>

<div id="ui">
    <div>DAY <span id="day">1</span>/30</div>
    <div>é€²åº¦ <span id="progress">0</span>/2</div>
</div>
<div id="msg-box"></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const msgBox = document.getElementById('msg-box');

canvas.width = 360;
canvas.height = 640;

let day = 1;
let progress = 0;
const reqProgress = 2; // æ¯é—œæˆåŠŸç©¿è¶Š 2 æ¬¡é€²ä¸‹ä¸€å¤©
let isPaused = false;
let gameSpeed = 1;

const player = { x: 165, y: 580, w: 30, h: 30, speed: 12, isFiring: false };
const enemies = [];
const quotes = ["åŠ ç­æ˜¯å¸¸æ…‹", "è€é—†åœ¨èƒŒå¾Œå¾ˆç«", "å®¢æˆ¶åˆæ”¹ç¨¿äº†", "æ²’éŒ¢å°±èªå‘½", "æˆ‘æƒ³å›å®¶", "æ·é‹å¥½æ“ "];

function spawnEnemy() {
    if (isPaused) return;
    const side = Math.random() > 0.5 ? 'left' : 'right';
    const isSpecial = Math.random() > 0.85; // 15% æ©Ÿç‡å‡ºç¾çå‹µ
    enemies.push({
        x: side === 'left' ? -50 : canvas.width + 50,
        y: 80 + Math.random() * 400,
        w: isSpecial ? 35 : 50,
        h: 40,
        speed: (2 + Math.random() * 3 + (day * 0.1)) * (side === 'left' ? 1 : -1),
        type: isSpecial ? 'BONUS' : 'BOSS',
        text: isSpecial ? 'ğŸ’° çé‡‘' : 'ğŸ¢ è€é—†'
    });
}
setInterval(spawnEnemy, 600);

function showPopup(text, duration) {
    isPaused = true;
    msgBox.innerText = text;
    msgBox.style.display = 'block';
    setTimeout(() => {
        msgBox.style.display = 'none';
        isPaused = false;
        if (progress >= reqProgress) nextDay();
    }, duration);
}

function nextDay() {
    day++;
    progress = 0;
    if (day > 30) {
        alert("æ­å–œï¼ä½ æˆåŠŸé›¢è·äº†ï¼ç²å¾—è‡ªç”±ï¼");
        day = 1;
    }
    updateUI();
    // èƒŒæ™¯é¡è‰²éš¨é—œå¡è®Šæ› (æ—©ä¸­æ™šå¾ªç’°)
    const hue = 200 - (day * 5 % 100);
    canvas.style.background = `hsl(${hue}, 50%, 60%)`;
}

function updateUI() {
    document.getElementById('day').innerText = day;
    document.getElementById('progress').innerText = progress;
}

function resetPlayer() {
    player.y = 580;
    player.isFiring = false;
}

function update() {
    if (isPaused) return;

    if (player.isFiring) {
        player.y -= player.speed;
        if (player.y < 20) {
            progress++;
            updateUI();
            if (progress >= reqProgress) {
                showPopup(`ç¬¬ ${day} å¤©å¹³å®‰ä¸‹ç­ï¼\nã€Œ${quotes[day % quotes.length]}ã€`, 1500);
            } else {
                resetPlayer();
            }
        }
    }

    enemies.forEach((en, i) => {
        en.x += en.speed;
        // ç¢°æ’åµæ¸¬
        if (player.isFiring && player.x < en.x + en.w && player.x + player.w > en.x &&
            player.y < en.y + en.h && player.y + player.h > en.y) {
            
            if (en.type === 'BOSS') {
                showPopup("æ…˜ï¼è¢«æŠ“å»åŠ ç­äº†ï¼", 1000);
            } else {
                progress = Math.min(reqProgress, progress + 1);
                updateUI();
            }
            resetPlayer();
            enemies.splice(i, 1);
        }
        if (en.x < -100 || en.x > 500) enemies.splice(i, 1);
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // çµ‚é»ç·š
    ctx.setLineDash([5, 5]);
    ctx.strokeStyle = "white";
    ctx.strokeRect(10, 10, 340, 40);
    
    // ç©å®¶ (è§’è‰²)
    ctx.fillStyle = "#FFD700";
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = "#000";
    ctx.font = "12px Arial";
    ctx.fillText("me", player.x + 8, player.y + 20);

    // æ•µäºº
    enemies.forEach(en => {
        ctx.fillStyle = en.type === 'BOSS' ? "#ff4d4d" : "#00ff88";
        ctx.fillRect(en.x, en.y, en.w, en.h);
        ctx.fillStyle = "white";
        ctx.font = "14px Arial";
        ctx.fillText(en.text, en.x + 2, en.y + 25);
    });
}

canvas.addEventListener('mousedown', () => { if(!isPaused) player.isFiring = true; });
canvas.addEventListener('touchstart', (e) => { 
    e.preventDefault();
    if(!isPaused) player.isFiring = true; 
}, {passive: false});

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
