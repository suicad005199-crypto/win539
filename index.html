<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>極限離職挑戰 30 DAY</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
        canvas { background: #2c3e50; border: 2px solid #34495e; }
        #ui { position: absolute; top: 15px; color: #ecf0f1; font-weight: bold; pointer-events: none; width: 340px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>
<div id="ui">
    <span>DAY <span id="dayNum">1</span></span>
    <span>PROGRESS <span id="prog">0</span>/2</span>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 360;
canvas.height = 640;

// --- 精確速度配置 (px/s) ---
const PLAYER_SPD = 800; 
const ENEMY_TYPES = [
    { name: '慢速老闆', color: '#e74c3c', spd: 1000, size: 50 },
    { name: '中速同事', color: '#e67e22', spd: 1500, size: 40 },
    { name: '快速客戶', color: '#f1c40f', spd: 2300, size: 30 }
];

let day = 1;
let progress = 0;
let player = { x: 165, y: 580, w: 30, h: 30, isFiring: false };
let enemies = [];
let lastTime = performance.now();

function spawn() {
    if (document.hidden) return;
    const type = ENEMY_TYPES[Math.floor(Math.random() * ENEMY_TYPES.length)];
    const side = Math.random() > 0.5 ? 1 : -1;
    enemies.push({
        x: side === 1 ? -100 : canvas.width + 100,
        y: 100 + Math.random() * 350,
        w: type.size, h: type.size,
        vx: type.spd * side,
        ...type
    });
}
// 因為敵人極快，生成頻率稍微放慢一點，避免畫面死局
setInterval(spawn, 400);

function update(dt) {
    if (player.isFiring) {
        player.y -= PLAYER_SPD * dt;
        if (player.y < 20) {
            progress++;
            if (progress >= 2) {
                day++;
                progress = 0;
                if(day > 30) alert("你自由了！徹底離職！");
            }
            resetPlayer();
        }
    }

    for (let i = enemies.length - 1; i >= 0; i--) {
        let en = enemies[i];
        en.x += en.vx * dt;

        // 碰撞
        if (player.isFiring &&
            player.x < en.x + en.w && player.x + player.w > en.x &&
            player.y < en.y + en.h && player.y + player.h > en.y) {
            resetPlayer();
        }
        // 出界判定 (範圍加大，因為敵人速度極快)
        if (en.x < -200 || en.x > canvas.width + 200) enemies.splice(i, 1);
    }
    
    document.getElementById('dayNum').innerText = day;
    document.getElementById('prog').innerText = progress;
}

function resetPlayer() {
    player.y = 580;
    player.isFiring = false;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 終點光帶
    ctx.fillStyle = "rgba(46, 204, 113, 0.2)";
    ctx.fillRect(0, 0, canvas.width, 40);

    // 敵人
    enemies.forEach(en => {
        ctx.fillStyle = en.color;
        ctx.fillRect(en.x, en.y, en.w, en.h);
        // 速度極快時畫影子增加動感
        ctx.fillStyle = "rgba(255,255,255,0.3)";
        ctx.fillRect(en.x - (en.vx*0.01), en.y, en.w, en.h);
    });

    // 玩家
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(player.x, player.y, player.w, player.h);
}

function loop(t) {
    let dt = (t - lastTime) / 1000;
    lastTime = t;
    update(dt > 0.1 ? 0 : dt);
    draw();
    requestAnimationFrame(loop);
}

canvas.addEventListener('mousedown', () => player.isFiring = true);
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); player.isFiring = true; });
requestAnimationFrame(loop);
</script>
</body>
</html>
