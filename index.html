<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 æˆ°ç•¥åˆ†æ V.43.0 å¼·åŒ–ç‰ˆ</title>
    <style>
        :root { --bg: #0d0d0d; --panel: #1a1a1c; --primary: #00ffcc; --border: #333; --text: #e0e0e0; --sub: #888; --hit: #ff2d55; --accent: #5856d6; --success: #34c759; }
        body { font-family: 'PingFang TC', system-ui; background: var(--bg); color: var(--text); margin: 0; padding: 12px; font-size: 13px; line-height: 1.4; }
        .container { display: flex; flex-direction: column; gap: 15px; max-width: 600px; margin: auto; }
        .panel { background: var(--panel); border-radius: 16px; padding: 16px; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        .panel-header { color: var(--primary); font-weight: bold; margin-bottom: 12px; border-left: 4px solid var(--primary); padding-left: 10px; font-size: 15px; display: flex; justify-content: space-between; }
        
        .bt-row { border-bottom: 1px solid #2c2c2e; padding: 12px 0; }
        .bt-row:last-child { border: none; }
        .bt-meta { display: flex; justify-content: space-between; margin-bottom: 8px; font-family: monospace; }
        .star-tag { background: var(--success); color: #000; padding: 2px 8px; border-radius: 6px; font-weight: 900; font-size: 11px; }
        .star-fail { background: #444; color: #aaa; }

        .num-group { display: flex; gap: 5px; align-items: center; margin-top: 5px; }
        .num-label { font-size: 10px; color: var(--sub); width: 35px; }
        .n-box { width: 26px; height: 26px; display: flex; align-items: center; justify-content: center; border-radius: 6px; background: #2c2c2e; font-size: 12px; font-weight: 600; transition: 0.3s; }
        .n-box.hit { background: var(--primary); color: #000; box-shadow: 0 0 10px rgba(0,255,204,0.4); }
        
        .ball-row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; padding: 10px 0; }
        .ball { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: transparent; border-radius: 50%; font-weight: bold; border: 2px solid var(--primary); color: var(--primary); font-size: 18px; box-shadow: inset 0 0 8px rgba(0,255,204,0.2); }
        
        input[type="file"] { background: #2c2c2e; color: var(--primary); border: 1px dashed var(--primary); padding: 10px; width: 100%; box-sizing: border-box; border-radius: 8px; cursor: pointer; }
        #logBox { background: #000; color: var(--success); padding: 12px; height: 100px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 11px; border-radius: 8px; border: 1px solid var(--border); margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <div class="panel-header">V.43.0 ç­–ç•¥æ³¨å…¥ (ç›®æ¨™ 3 æ˜Ÿç‡ 80%+)</div>
        <input type="file" id="csvFile" accept=".csv">
    </div>

    <div class="panel">
        <div class="panel-header">ğŸ¯ ä¸‹æœŸç²¾é¸ 8 ç¢¼</div>
        <div id="nextPred" class="ball-row">--</div>
    </div>

    <div class="panel">
        <div class="panel-header">ğŸ“Š è¿‘ 10 æœŸå„ªåŒ–å›æ¸¬</div>
        <div id="btBody"></div>
    </div>

    <div id="logBox">è«‹åŒ¯å…¥æ­·å² CSV æ•¸æ“šå•Ÿå‹•æ¨¡æ“¬...</div>
</div>

<script>
    let rawData = [];
    const log = (m) => { const b = document.getElementById('logBox'); b.innerHTML += `> ${m}<br>`; b.scrollTop = b.scrollHeight; };
    const pad = (n) => n.toString().padStart(2, '0');

    // V.43.0 æ ¸å¿ƒæ¼”ç®—æ³•ï¼šå¼·åŒ– 3 æ˜Ÿçµæ§‹
    function getV430Prediction(hist) {
        if(hist.length < 20) return [1,2,3,4,5,6,7,8];
        
        let stats = Array(40).fill(0).map((_, i) => ({ n: i, score: 0 }));
        const lastRow = hist[hist.length-1].nums;

        // 1. éºæ¼å€¼åŠ æ¬Š (é‡å° 3-9 æœŸæœªé–‹è™Ÿç¢¼åŠ ç¢¼)
        for(let i=1; i<=39; i++) {
            let gap = 0;
            for(let k=hist.length-1; k>=0; k--) {
                if(!hist[k].nums.includes(i)) gap++; else break;
            }
            if(gap >= 3 && gap <= 9) stats[i].score += 45; // 3æ˜Ÿå¸¸è¦‹é–“éš”
            else if(gap < 3) stats[i].score += 25; // ç†±ç¢¼æŒçºŒ
            else stats[i].score += Math.max(0, 15 - gap);
        }

        // 2. å°¾æ•¸ç†±åº¦ (è¿‘ 12 æœŸ)
        let tailMap = Array(10).fill(0);
        hist.slice(-12).forEach(d => d.nums.forEach(n => tailMap[n%10]++));
        for(let i=1; i<=39; i++) stats[i].score += (tailMap[i%10] * 5.5);

        // 3. é„°ç¢¼èˆ‡é€£è™Ÿè£œå„Ÿ (3æ˜Ÿé—œéµ)
        lastRow.forEach(ln => {
            if(ln > 1) stats[ln-1].score += 35;
            if(ln < 39) stats[ln+1].score += 35;
            stats[ln].score += 15; // é‡è¤‡é–‹å‡ºæ¬Šé‡
        });

        // 4. å‹•æ…‹åˆ†å€é¸æ“‡ (ç¢ºä¿ 1-13, 14-26, 27-39 éƒ½æœ‰è¦†è“‹)
        let pool = [];
        let zones = [
            stats.slice(1, 14).sort((a,b)=>b.score-a.score),
            stats.slice(14, 27).sort((a,b)=>b.score-a.score),
            stats.slice(27, 40).sort((a,b)=>b.score-a.score)
        ];

        // ä¾æ“šå„å€è¿‘æœŸç¸½å¾—åˆ†åˆ†é…åé¡ (3-2-3 æˆ– 2-3-3 æ¯”ä¾‹)
        pool.push(...zones[0].slice(0, 3));
        pool.push(...zones[1].slice(0, 2));
        pool.push(...zones[2].slice(0, 3));

        return pool.sort((a,b)=>b.score-a.score).map(x=>x.n).sort((a,b)=>a-b);
    }

    document.getElementById('csvFile').addEventListener('change', e => {
        const reader = new FileReader();
        reader.onload = () => {
            rawData = reader.result.replace(/\r/g, "").trim().split('\n').map(l => {
                const c = l.split(',');
                return { date: c[0].trim(), nums: c.slice(1, 6).map(x => parseInt(x.trim())).filter(x => !isNaN(x)).sort((a,b)=>a-b) };
            }).filter(r => r.nums.length === 5);
            document.getElementById('logBox').innerHTML = "";
            runV430();
        };
        reader.readAsText(e.target.files[0]);
    });

    function runV430() {
        let btHtml = "";
        let threeStarCount = 0;
        const testCount = 10;
        
        const recentData = rawData.slice(-testCount).reverse();
        recentData.forEach(row => {
            const histSlice = rawData.slice(0, rawData.indexOf(row));
            const pred = getV430Prediction(histSlice);
            const hits = row.nums.filter(n => pred.includes(n));
            const isTarget = hits.length >= 3;
            if(isTarget) threeStarCount++;

            btHtml += `<div class="bt-row">
                <div class="bt-meta">
                    <span>ğŸ“… ${row.date}</span> 
                    <span class="star-tag ${isTarget ? '' : 'star-fail'}">${hits.length} æ˜Ÿå‘½ä¸­</span>
                </div>
                <div class="num-group">
                    <span class="num-label">é–‹çï¼š</span>
                    ${row.nums.map(n => `<div class="n-box ${pred.includes(n)?'hit':''}">${pad(n)}</div>`).join('')}
                </div>
                <div class="num-group">
                    <span class="num-label">å»ºè­°ï¼š</span>
                    ${pred.map(n => `<div class="n-box" style="border: 1px solid ${row.nums.includes(n)?'var(--primary)':'#444'}">${pad(n)}</div>`).join('')}
                </div>
            </div>`;
        });

        document.getElementById('btBody').innerHTML = btHtml;
        const next = getV430Prediction(rawData);
        document.getElementById('nextPred').innerHTML = next.map(n => `<div class="ball">${pad(n)}</div>`).join('');
        
        log(`æ•¸æ“šè®€å–ï¼š${rawData.length} æœŸ`);
        log(`V.43.0 æ¨¡æ“¬ï¼šè¿‘ 10 æœŸä¸­æœ‰ ${threeStarCount} æœŸé”æˆ 3 æ˜Ÿä»¥ä¸Šç›®æ¨™`);
        log(`ç•¶å‰ 3 æ˜Ÿé”æˆç‡ï¼š${(threeStarCount/testCount*100).toFixed(0)}%`);
    }
</script>
</body>
</html>
