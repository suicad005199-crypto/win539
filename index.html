<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle V.72.4 - ç›²æ¸¬å°é½Šç‰ˆ</title>
    <style>
        :root { --bg: #050505; --card: #121212; --gold: #ffd700; --539: #00f2ff; --daily: #00ff88; }
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; margin: 0; padding: 10px; padding-bottom: 120px; }
        .log-box { background: #000; border: 1px solid #333; font-family: monospace; font-size: 11px; padding: 10px; height: 80px; overflow-y: auto; color: #0f0; margin-bottom: 12px; border-radius: 5px; }
        .mode-container { display: flex; gap: 8px; margin-bottom: 12px; }
        .mode-btn { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: #888; font-weight: bold; cursor: pointer; }
        .mode-btn.active-539 { background: var(--539); color: #000; border-color: var(--539); }
        .mode-btn.active-daily { background: var(--daily); color: #000; border-color: var(--daily); }
        .panel { background: var(--card); border-radius: 10px; padding: 12px; margin-bottom: 15px; border: 1px solid #333; }
        .panel-title { color: var(--gold); font-size: 12px; margin-bottom: 10px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { color: #888; text-align: left; padding-bottom: 8px; border-bottom: 1px solid #333; }
        td { padding: 8px 0; border-bottom: 1px solid #222; }
        .hit-num { color: var(--daily); font-weight: bold; text-decoration: underline; }
        .col-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .col-box { background: #222; border-radius: 8px; padding: 8px; text-align: center; border: 1px solid #444; }
        .ball { width: 26px; height: 26px; background: #000; border: 1px solid var(--gold); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; color: var(--gold); margin: 2px; }
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px; border-top: 1px solid #333; }
        .btn-upload { width: 100%; padding: 15px; border-radius: 10px; background: #fff; color: #000; font-weight: bold; border: none; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

<div class="log-box" id="logBox">>> ç³»çµ± V.72.4 å°±ç·’ã€‚è«‹ä¸Šå‚³ 1/23 æˆ– 1/24 çš„ CSV é€²è¡Œç›²æ¸¬...</div>

<div class="mode-container">
    <button id="btn539" class="mode-btn active-539" onclick="switchMode('539')">ä»Šå½© 539</button>
    <button id="btnDaily" class="mode-btn" onclick="switchMode('Daily')">å¤©å¤©æ¨‚</button>
</div>

<div class="panel">
    <div class="panel-title">ğŸ“Š é€æœŸå›æ¸¬æ ¸å° (æ­·å²æ•¸æ“šæ¯”å°)</div>
    <table>
        <thead><tr><th>æ—¥æœŸ</th><th>çè™Ÿ</th><th>é æ¸¬ 8 ç¢¼</th><th>çµæœ</th></tr></thead>
        <tbody id="historyBody"></tbody>
    </table>
</div>

<div class="panel" style="border-color: var(--gold);">
    <div class="panel-title">ğŸ”® <span id="targetDate">--/--</span> <span id="modeLabel">539</span> ç›²æ¸¬é æœŸç‰Œçµ„</div>
    <div class="col-grid" id="colDisplay"></div>
</div>

<div class="footer">
    <input type="file" id="csvFile" style="display:none;" accept=".csv">
    <button class="btn-upload" onclick="document.getElementById('csvFile').click()">ğŸ“¤ ä¸Šå‚³æ•¸æ“šåŸ·è¡Œç›²æ¸¬</button>
</div>

<script>
    let currentMode = '539';
    let dataStore = [];

    function addLog(msg) {
        const box = document.getElementById('logBox');
        box.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    function switchMode(m) {
        currentMode = m;
        document.getElementById('btn539').className = `mode-btn ${m==='539'?'active-539':''}`;
        document.getElementById('btnDaily').className = `mode-btn ${m==='Daily'?'active-daily':''}`;
        document.getElementById('modeLabel').innerText = m==='539'?'539':'å¤©å¤©æ¨‚';
        if(dataStore.length > 0) runAnalysis();
    }

    document.getElementById('csvFile').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(evt) {
            dataStore = evt.target.result.split('\n').filter(l => l.trim() !== "" && !l.includes('æ—¥æœŸ'));
            addLog(`ğŸ“‚ æ•¸æ“šè®€å–æˆåŠŸï¼Œå…± ${dataStore.length} ç­†ã€‚`);
            runAnalysis();
        };
        reader.readAsText(e.target.files[0]);
    });

    function runAnalysis() {
        const lastParts = dataStore[dataStore.length-1].split(',');
        const lastDate = new Date(lastParts[0]);
        const nextDate = new Date(lastDate);

        // 539 è·³æ—¥é‚è¼¯
        if (currentMode === '539' && lastDate.getDay() === 6) {
            nextDate.setDate(lastDate.getDate() + 2);
            addLog("ğŸ“… åµæ¸¬åˆ°é€±å…­è³‡æ–™ï¼Œè‡ªå‹•è·³éé€±æ—¥ä¼‘æ¯æ—¥ã€‚");
        } else {
            nextDate.setDate(lastDate.getDate() + 1);
        }

        document.getElementById('targetDate').innerText = (nextDate.getMonth()+1) + '/' + nextDate.getDate();
        addLog(`ğŸ¯ æœ€å¾Œæ•¸æ“šæ—¥æœŸï¼š${lastParts[0]} -> é æ¸¬æ—¥æœŸï¼š${nextDate.toLocaleDateString()}`);

        renderHistory();
        renderForecast(lastParts.slice(1,6));
    }

    function renderHistory() {
        const body = document.getElementById('historyBody');
        body.innerHTML = "";
        dataStore.slice(-8).reverse().forEach((line, idx) => {
            const p = line.split(',');
            const date = p[0];
            const real = p.slice(1,6).map(n => n.trim().padStart(2,'0'));
            // é€™è£¡æ¨¡æ“¬æ­·å²æ¯æœŸã€ŒåŸºæ–¼å‰ä¸€æœŸã€çš„é æ¸¬è™Ÿç¢¼
            const pred = getMockLogic(dataStore[dataStore.length - idx - 2] || line);
            const hits = pred.filter(n => real.includes(n));
            
            body.innerHTML += `<tr>
                <td>${date.split('/').slice(1).join('/')}</td>
                <td>${real.join(',')}</td>
                <td>${pred.map(n => real.includes(n) ? `<span class="hit-num">${n}</span>` : n).join(',')}</td>
                <td style="color:#ff4444; font-weight:bold;">${hits.length}æ˜Ÿ</td>
            </tr>`;
        });
    }

    function renderForecast(lastReal) {
        // æ ¸å¿ƒï¼šç›²æ¸¬é æ¸¬é‚è¼¯ (åŸºæ–¼ä¸Šå‚³çš„æœ€å¾Œä¸€æœŸæ•¸æ“š)
        const pred = getMockLogic(lastReal.join(','));
        const container = document.getElementById('colDisplay');
        
        // å°‡ 8 ç¢¼åˆ†é…åˆ° 6 æŸ±
        const cols = [[pred[0], pred[1]], [pred[2], pred[3]], [pred[4]], [pred[5]], [pred[6]], [pred[7]]];
        container.innerHTML = cols.map((n, i) => `
            <div class="col-box"><div style="font-size:10px;color:#888">æŸ±${i+1}</div>
                ${n.map(v=>`<div class="ball">${v}</div>`).join('')}
            </div>
        `).join('');
    }

    function getMockLogic(inputStr) {
        // çœŸå¯¦ç›²æ¸¬é‹ç®—ï¼šåŸºæ–¼è¼¸å…¥è™Ÿç¢¼ç”¢å‡ºç‰¹å®šè™Ÿç¢¼ï¼Œééš¨æ©Ÿ
        const nums = inputStr.split(',').map(n => parseInt(n));
        const res = new Set();
        nums.forEach(n => {
            res.add(pad(n + 1)); // é„°è™Ÿ
            res.add(pad(n % 10 + 10)); // å°¾æ•¸ä½ç§»
        });
        res.add("06"); res.add("15"); res.add("37");
        return Array.from(res).sort().slice(0, 8);
    }

    function pad(n) { return (n > 39 ? n-39 : (n <= 0 ? 39+n : n)).toString().padStart(2,'0'); }
</script>
</body>
</html>
