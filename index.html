<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¤¾ç•œ 30 å¤©ï¼šé€ƒé›¢è¾¦å…¬å®¤</title>
    <style>
        body { margin: 0; background: #111; overflow: hidden; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        #game-container { position: relative; width: 100vw; height: 100vh; max-width: 450px; margin: auto; }
        canvas { background: #f0f0f0; display: block; }
        
        /* é—œå¡é€²åº¦æ¢ */
        #ui-layer { position: absolute; top: 0; width: 100%; pointer-events: none; }
        .day-banner { background: #ff4d4d; color: white; padding: 10px; text-align: center; font-weight: bold; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .progress-bar { height: 8px; background: #ddd; width: 80%; margin: 10px auto; border-radius: 4px; overflow: hidden; }
        #fill { height: 100%; background: #4caf50; width: 0%; transition: width 0.3s; }

        /* æµ®å‹•è¨Šæ¯ */
        #msg-layer { position: absolute; top: 50%; width: 100%; transform: translateY(-50%); text-align: center; display: none; }
        .comic-box { background: white; border: 4px solid #000; padding: 20px; display: inline-block; border-radius: 10px; font-weight: bold; position: relative; }
        .comic-box::after { content: ''; position: absolute; bottom: -15px; left: 50%; border-width: 15px 15px 0; border-style: solid; border-color: #000 transparent; margin-left: -15px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-layer">
        <div class="day-banner">ğŸ“… DAY <span id="day-num">1</span> / 30</div>
        <div class="progress-bar"><div id="fill"></div></div>
    </div>
    
    <div id="msg-layer">
        <div class="comic-box" id="msg-text">è¢«æŠ“å»æ”¹ PPTï¼</div>
    </div>
    
    <canvas id="gameCanvas"></canvas>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const fill = document.getElementById('fill');
const dayNum = document.getElementById('day-num');
const msgLayer = document.getElementById('msg-layer');
const msgText = document.getElementById('msg-text');

canvas.width = window.innerWidth > 450 ? 450 : window.innerWidth;
canvas.height = window.innerHeight;

let day = 1;
let subLevel = 0;
const subsPerDay = 3;
let isPaused = false;

const player = { x: canvas.width/2 - 20, y: canvas.height - 80, w: 40, h: 40, speed: 15, isFiring: false };
const enemies = [];

// æç¬‘äº‹ä»¶åº«
const fails = ["è€é—†å«ä½ é€²è¾¦å…¬å®¤", "å¹«éš”å£æ¡Œè¨‚ä¾¿ç•¶", "å½±å°æ©Ÿå¤¾ç´™äº†", "å®¢æˆ¶èªªå›æ­¸åˆç‰ˆ", "è¢«æ‹‰é€²ç„¡æ„ç¾©æœƒè­°", "é€™é€±è¦åŠ ç­å–”"];
const wins = ["æˆåŠŸæº–æ™‚æ‰“å¡ï¼", "è€é—†æ²’çœ‹åˆ°ä½ ", "å‡è£å»å»æ‰€æˆåŠŸ", "é–ƒéä¸»ç®¡è¦–ç·š"];

function spawn() {
    if (isPaused) return;
    const isLeft = Math.random() > 0.5;
    enemies.push({
        x: isLeft ? -60 : canvas.width + 60,
        y: 120 + Math.random() * (canvas.height - 250),
        w: 60, h: 50,
        speed: (2 + (day * 0.2)) * (isLeft ? 1 : -1),
        label: ["è€é—†", "ä¸»ç®¡", "æ”¹ç¨¿", "æœƒè­°"][Math.floor(Math.random()*4)]
    });
}
setInterval(spawn, 700 - (day * 10));

function triggerEvent(text, isWin) {
    isPaused = true;
    msgText.innerText = text;
    msgText.style.borderColor = isWin ? "#4caf50" : "#ff4d4d";
    msgLayer.style.display = 'block';
    
    setTimeout(() => {
        msgLayer.style.display = 'none';
        isPaused = false;
        if(isWin && subLevel >= subsPerDay) nextDay();
        resetPlayer();
    }, 1200);
}

function nextDay() {
    day++;
    subLevel = 0;
    dayNum.innerText = day;
    fill.style.width = "0%";
    if(day > 30) alert("ä½ è‡ªç”±äº†ï¼å…‰æ¦®é€€ä¼‘ï¼");
}

function resetPlayer() {
    player.y = canvas.height - 80;
    player.isFiring = false;
}

function update() {
    if (isPaused) return;

    if (player.isFiring) {
        player.y -= player.speed;
        if (player.y < 50) {
            subLevel++;
            fill.style.width = (subLevel / subsPerDay) * 100 + "%";
            triggerEvent(wins[Math.floor(Math.random()*wins.length)], true);
        }
    }

    enemies.forEach((en, i) => {
        en.x += en.speed;
        if (player.isFiring && 
            player.x < en.x + en.w && player.x + player.w > en.x &&
            player.y < en.y + en.h && player.y + player.h > en.y) {
            triggerEvent(fails[Math.floor(Math.random()*fails.length)], false);
            enemies.length = 0; // æ¸…ç©ºæ•µäºº
        }
        if (en.x < -100 || en.x > canvas.width + 100) enemies.splice(i, 1);
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ç¹ªè£½çµ‚é»ç·š (å…¬å¸å¤§é–€)
    ctx.fillStyle = "#333";
    ctx.fillRect(0, 50, canvas.width, 10);
    ctx.fillText("ğŸšª å…¬å¸å¤§é–€ (è‡ªç”±å‡ºå£)", canvas.width/2 - 50, 40);

    // ç¹ªè£½ç©å®¶ (åƒå€‹å°æ–¹å¡Šäºº)
    ctx.fillStyle = "#FFD700";
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = "#000";
    ctx.font = "bold 14px Arial";
    ctx.fillText("ğŸƒ æˆ‘", player.x + 5, player.y + 25);

    // ç¹ªè£½æ•µäºº
    enemies.forEach(en => {
        ctx.fillStyle = "#fff";
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.strokeRect(en.x, en.y, en.w, en.h);
        ctx.fillRect(en.x, en.y, en.w, en.h);
        ctx.fillStyle = "#ff4d4d";
        ctx.fillText("ğŸ‘¿" + en.label, en.x + 5, en.y + 30);
    });
}

canvas.addEventListener('touchstart', (e) => { 
    if(!isPaused && !player.isFiring) player.isFiring = true; 
});
canvas.addEventListener('mousedown', () => { 
    if(!isPaused && !player.isFiring) player.isFiring = true; 
});

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
