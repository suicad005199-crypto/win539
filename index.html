<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿…ä¸­ v3 - æ™ºèƒ½é æ¸¬ç³»çµ±</title>
<style>
:root {
  --primary: #00ff99;
  --secondary: #274c77;
  --danger: #ff6666;
  --warning: #ffcc00;
  --info: #4fc3f7;
  --bg-0: #050b15;
  --bg-1: #0f1f38;
  --bg-2: #142b4d;
  --bg-3: #1a355c;
  --bg-4: #203f6e;
  --text-light: #e0f7ff;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
  background: linear-gradient(135deg,#0b1626,#051122); 
  color: var(--text-light); 
  line-height:1.6; 
  min-height:100vh;
}
.container { 
  max-width:900px; 
  margin:0 auto; 
  padding:20px;
}
.header { 
  text-align:center; 
  padding:30px 0; 
  background:linear-gradient(90deg,var(--bg-0),var(--bg-1)); 
  border-radius:20px; 
  margin-bottom:20px; 
  position:relative; 
  overflow:hidden;
}
.header::before { 
  content:''; 
  position:absolute; 
  top:0; 
  left:0; 
  right:0; 
  height:4px; 
  background:linear-gradient(90deg,var(--primary),var(--warning)); 
}
.header h1 { 
  font-size:2.5rem; 
  color:var(--primary); 
  margin-bottom:10px; 
  text-shadow:0 0 20px rgba(0,255,153,0.3);
}
.subtitle { 
  color:#8da1b9; 
  font-size:1.1rem;
}
.panel { 
  border-radius:16px; 
  padding:24px; 
  margin-bottom:20px; 
  border:1px solid rgba(255,255,255,0.05); 
  transition: transform 0.3s ease, box-shadow 0.3s ease; 
  position:relative;
}
.panel:hover { 
  transform:translateY(-5px); 
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
}
.panel-0 { background: var(--bg-0); }
.panel-1 { background: var(--bg-1); }
.panel-2 { background: var(--bg-2); }
.panel-3 { background: var(--bg-3); }
.panel-4 { background: var(--bg-4); }
.panel h2 { 
  font-size:1.4rem; 
  color: var(--primary); 
  margin-bottom:20px; 
  display:flex; 
  align-items:center; 
  gap:10px;
}
.panel h2::before { 
  content:''; 
  width:6px; 
  height:24px; 
  background:var(--primary); 
  border-radius:3px; 
}
.file-input, .text-input, .select-input { 
  width:100%; 
  padding:16px; 
  border-radius:12px; 
  font-size:16px; 
  margin-bottom:15px;
}
.file-input { 
  border:2px dashed rgba(0,255,153,0.3); 
  background:rgba(0,0,0,0.2); 
  color:white; 
  cursor:pointer; 
  transition: all 0.3s ease;
}
.file-input:hover { 
  border-color: var(--primary); 
  background: rgba(0,255,153,0.05);
}
.file-input::file-selector-button { 
  background: var(--primary); 
  color: var(--bg-0); 
  border:none; 
  padding:10px 20px; 
  border-radius:8px; 
  font-weight:bold; 
  cursor:pointer; 
  margin-right:15px;
}
.text-input { 
  border:2px solid rgba(255,255,255,0.1); 
  background: rgba(0,0,0,0.2); 
  color:white; 
  transition: all 0.3s ease;
}
.text-input:focus { 
  outline:none; 
  border-color:var(--primary); 
  box-shadow:0 0 0 3px rgba(0,255,153,0.1);
}
.select-input {
  border:2px solid rgba(255,255,255,0.1);
  background: rgba(0,0,0,0.2);
  color: white;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 16px center;
  background-size: 20px;
  padding-right: 50px;
}
.btn { 
  width:100%; 
  padding:16px; 
  border:none; 
  border-radius:12px; 
  background:linear-gradient(135deg,var(--secondary),#1a3a5f); 
  color:white; 
  font-size:16px; 
  font-weight:600; 
  cursor:pointer; 
  transition: all 0.3s ease; 
  position:relative; 
  overflow:hidden; 
  margin-bottom: 10px;
}
.btn::after { 
  content:''; 
  position:absolute; 
  top:0; 
  left:-100%; 
  width:100%; 
  height:100%; 
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); 
  transition:left 0.5s ease; 
}
.btn:hover { 
  transform:translateY(-2px); 
  box-shadow:0 8px 20px rgba(39,76,119,0.3); 
}
.btn:hover::after { 
  left:100%; 
}
.btn:active { 
  transform:translateY(0);
}
.btn-primary { 
  background:linear-gradient(135deg,var(--primary),#00cc7a);
}
.btn-secondary { 
  background:linear-gradient(135deg,var(--info),#0288d1);
}
.btn-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 15px;
}
.box { 
  background:rgba(0,0,0,0.3); 
  border-radius:12px; 
  padding:20px; 
  margin-top:20px; 
  border:1px solid rgba(255,255,255,0.05);
}
.box-title { 
  color:var(--primary); 
  font-size:1.1rem; 
  margin-bottom:12px; 
  display:flex; 
  align-items:center; 
  gap:8px;
}
.numbers-grid { 
  display:grid; 
  grid-template-columns:repeat(auto-fill,minmax(60px,1fr)); 
  gap:10px; 
  margin:15px 0;
}
.number-ball { 
  width:60px; 
  height:60px; 
  border-radius:50%; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  font-size:1.4rem; 
  font-weight:bold; 
  background:linear-gradient(135deg,var(--secondary),#1a3a5f); 
  color:white; 
  transition: all 0.3s ease; 
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
}
.number-ball.hot { 
  background: linear-gradient(135deg, #ff6666, #cc0000);
}
.number-ball.cold { 
  background: linear-gradient(135deg, #4fc3f7, #0288d1);
}
.number-ball.missed { 
  background: linear-gradient(135deg, var(--warning), #ff9800);
}
.number-ball:hover { 
  transform: scale(1.1) rotate(5deg); 
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}
.stats-row { 
  display:grid; 
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); 
  gap:15px; 
  margin:15px 0;
}
.stat-item { 
  background: rgba(255,255,255,0.05); 
  padding:15px; 
  border-radius:10px; 
  text-align:center;
}
.stat-label { 
  color:#8da1b9; 
  font-size:0.9rem; 
  margin-bottom:5px;
}
.stat-value { 
  color:var(--primary); 
  font-size:1.3rem; 
  font-weight:bold;
}
.status { 
  padding:12px; 
  border-radius:8px; 
  margin:10px 0; 
  display:flex; 
  align-items:center; 
  gap:10px; 
  font-size:0.9rem;
}
.status.success { 
  background: rgba(0,255,153,0.1); 
  border:1px solid rgba(0,255,153,0.3); 
  color: var(--primary);
}
.status.warning { 
  background: rgba(255,204,0,0.1); 
  border:1px solid rgba(255,204,0,0.3); 
  color: var(--warning);
}
.status.error { 
  background: rgba(255,102,102,0.1); 
  border:1px solid rgba(255,102,102,0.3); 
  color: var(--danger);
}
.status.info { 
  background: rgba(79,195,247,0.1); 
  border:1px solid rgba(79,195,247,0.3); 
  color: var(--info);
}
.loading { 
  display:none; 
  text-align:center; 
  padding:20px;
}
.spinner { 
  width:40px; 
  height:40px; 
  border:4px solid rgba(0,255,153,0.1); 
  border-top:4px solid var(--primary); 
  border-radius:50%; 
  animation:spin 1s linear infinite; 
  margin:0 auto 15px;
}
@keyframes spin { 
  0% { transform:rotate(0deg); } 
  100% { transform:rotate(360deg); }
}
.footer { 
  text-align:center; 
  padding:20px; 
  color:#8da1b9; 
  font-size:0.9rem; 
  margin-top:40px; 
  border-top:1px solid rgba(255,255,255,0.05);
}
.footer a { 
  color: var(--primary); 
  text-decoration:none;
}
.footer a:hover { 
  text-decoration:underline;
}
.predictions-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
  margin-top: 20px;
}
.prediction-card {
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  padding: 15px;
  border: 1px solid rgba(0,255,153,0.2);
}
.prediction-title {
  color: var(--info);
  font-size: 1rem;
  margin-bottom: 10px;
  text-align: center;
}
@media(max-width:768px){
  .container{padding:15px;}
  .header h1{font-size:2rem;}
  .panel{padding:20px;}
  .numbers-grid{grid-template-columns:repeat(auto-fill,minmax(50px,1fr));}
  .number-ball{width:50px;height:50px;font-size:1.2rem;}
  .stats-row{grid-template-columns:1fr 1fr;}
  .predictions-container{grid-template-columns:1fr;}
  .btn-group{grid-template-columns:1fr;}
}
@media(max-width:480px){
  .stats-row{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>å¿…ä¸­ v3</h1>
    <div class="subtitle">æ™ºèƒ½é æ¸¬åˆ†æç³»çµ± | å¤šç­–ç•¥å…¨è»Šè™Ÿç¢¼é æ¸¬</div>
  </div>

  <!-- Panel 1ï¼šæ•¸æ“šå°å…¥ -->
  <div class="panel panel-1">
    <h2>ğŸ“Š æ•¸æ“šå°å…¥å±¤</h2>
    <input type="file" id="csvInput" class="file-input" accept=".csv">
    <div id="csvInfo" class="status"></div>
    <div class="stats-row" id="basicStats" style="display: none;"></div>
  </div>

  <!-- Panel Aï¼šæ™ºèƒ½åˆ†æ -->
  <div class="panel panel-2">
    <h2>ğŸ” æ™ºèƒ½åˆ†æå±¤</h2>
    <button class="btn btn-primary" onclick="runAnalysis()">åŸ·è¡Œæ·±åº¦åˆ†æ</button>
    <div class="loading" id="loadingA"><div class="spinner"></div><div>æ­£åœ¨åˆ†ææ•¸æ“š...</div></div>
    <div id="panelA" style="display: none;"></div>
  </div>

  <!-- Panel Bï¼šçµ„åˆé©—è­‰ -->
  <div class="panel panel-3">
    <h2>âœ… çµ„åˆé©—è­‰å±¤</h2>
    <input type="text" id="verifyInput" class="text-input" placeholder="è¼¸å…¥é©—è­‰çµ„åˆï¼Œä¾‹å¦‚ï¼š1 2 16 33 35">
    <button class="btn" onclick="runVerify()">åˆ†æçµ„åˆ</button>
    <div id="panelB" style="display: none;"></div>
  </div>

  <!-- Panel Cï¼šé æ¸¬ç”Ÿæˆ -->
  <div class="panel panel-4">
    <h2>ğŸ¯ é æ¸¬ç”Ÿæˆå±¤</h2>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="generateStandardPrediction()">æ¨™æº–é æ¸¬</button>
      <button class="btn btn-secondary" onclick="generateAdvancedPrediction()">é€²éšé æ¸¬</button>
    </div>
    <select class="select-input" id="strategySelect">
      <option value="balanced">å‡è¡¡ç­–ç•¥</option>
      <option value="hot">ç†±é–€ç­–ç•¥</option>
      <option value="cold">å†·é–€ç­–ç•¥</option>
      <option value="pattern">æ¨¡å¼ç­–ç•¥</option>
    </select>
    <div class="loading" id="loadingC"><div class="spinner"></div><div>æ­£åœ¨ç”Ÿæˆé æ¸¬...</div></div>
    <div id="panelC" style="display: none;"></div>
  </div>

  <!-- Panel Dï¼šå…¨è»Šè™Ÿç¢¼é æ¸¬ -->
  <div class="panel panel-0">
    <h2>ğŸš— å…¨è»Šè™Ÿç¢¼é æ¸¬å±¤</h2>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="generateFullCarByFrequency()">æŒ‰é »ç‡æ’åº</button>
      <button class="btn btn-secondary" onclick="generateFullCarByMissed()">æŒ‰éºæ¼æ’åº</button>
    </div>
    <button class="btn" onclick="generateMultiplePredictions()">å¤šç­–ç•¥é æ¸¬çµ„åˆ</button>
    <div class="loading" id="loadingD"><div class="spinner"></div><div>æ­£åœ¨ç”Ÿæˆå…¨è»Šè™Ÿç¢¼...</div></div>
    <div id="panelD" style="display: none;"></div>
  </div>

  <div class="footer">
    <p>âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç³»çµ±åƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œä¸å…·ä»»ä½•é æ¸¬ä¿è­‰åŠŸèƒ½</p>
    <p>å½©ç¥¨é–‹çç‚ºéš¨æ©Ÿäº‹ä»¶ï¼Œè«‹ç†æ€§åƒèˆ‡ï¼Œé‡åŠ›è€Œè¡Œ</p>
  </div>
</div>

<script>
// ==================== å…¨å±€è³‡æ–™ ====================
let data = [];
let analysisCache = null;
let numberStats = {};

// ==================== CSV è¼‰å…¥ ====================
document.getElementById("csvInput").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(!file) return;
  
  const reader = new FileReader();
  reader.onload = function(evt){
    const content = evt.target.result.trim();
    const lines = content.split(/\r?\n/);
    data = [];
    numberStats = {};
    
    // åˆå§‹åŒ–è™Ÿç¢¼çµ±è¨ˆ
    for(let i = 1; i <= 39; i++) {
      numberStats[i] = {
        count: 0,
        lastSeen: 0,
        gaps: [],
        consecutivePairs: 0
      };
    }
    
    // è§£ææ¯ä¸€è¡Œ
    lines.forEach((line, i) => {
      if(i === 0) return; // è·³éæ¨™é¡Œè¡Œ
      
      const parts = line.split(",");
      if(parts.length >= 6) {
        const date = parts[0].trim();
        const numbers = parts.slice(1, 6).map(n => parseInt(n.trim()));
        
        if(numbers.every(n => !isNaN(n) && n >= 1 && n <= 39)) {
          data.push({date, numbers});
          
          // æ›´æ–°è™Ÿç¢¼çµ±è¨ˆ
          numbers.forEach(n => {
            numberStats[n].count++;
            numberStats[n].lastSeen = 0;
          });
          
          // æ›´æ–°æ‰€æœ‰è™Ÿç¢¼çš„éºæ¼æœŸæ•¸
          for(let i = 1; i <= 39; i++) {
            if(!numbers.includes(i)) {
              numberStats[i].lastSeen++;
            } else {
              numberStats[i].lastSeen = 0;
            }
          }
          
          // æ›´æ–°é€£è™Ÿçµ±è¨ˆ
          const sorted = [...numbers].sort((a,b) => a-b);
          for(let i = 0; i < sorted.length - 1; i++) {
            if(sorted[i+1] - sorted[i] === 1) {
              numberStats[sorted[i]].consecutivePairs++;
              numberStats[sorted[i+1]].consecutivePairs++;
            }
          }
        }
      }
    });
    
    if(data.length === 0) {
      showStatus("csvInfo", "æœªæ‰¾åˆ°æœ‰æ•ˆæ•¸æ“šï¼Œè«‹æª¢æŸ¥CSVæ ¼å¼", "error");
      return;
    }
    
    showStatus("csvInfo", `âœ… å·²è¼‰å…¥ ${data.length} æœŸæ•¸æ“š | æ™‚é–“ç¯„åœï¼š${data[0].date} ~ ${data[data.length-1].date}`, "success");
    showBasicStats();
  };
  
  reader.readAsText(file);
});

// ==================== åŸºæœ¬çµ±è¨ˆé¡¯ç¤º ====================
function showBasicStats() {
  const container = document.getElementById("basicStats");
  const totalDraws = data.length;
  
  // è¨ˆç®—ç†±é–€å’Œå†·é–€è™Ÿç¢¼
  const sortedByCount = Object.entries(numberStats)
    .sort(([,a], [,b]) => b.count - a.count)
    .map(([num]) => parseInt(num));
  
  const hotNumbers = sortedByCount.slice(0, 5);
  const coldNumbers = sortedByCount.slice(-5).reverse();
  
  // è¨ˆç®—éºæ¼æœ€å¤šçš„è™Ÿç¢¼
  const sortedByMiss = Object.entries(numberStats)
    .sort(([,a], [,b]) => b.lastSeen - a.lastSeen)
    .slice(0, 3)
    .map(([num]) => parseInt(num));
  
  container.style.display = "grid";
  container.innerHTML = `
    <div class="stat-item">
      <div class="stat-label">ç¸½æœŸæ•¸</div>
      <div class="stat-value">${totalDraws}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">ç†±é–€è™Ÿç¢¼</div>
      <div class="stat-value">${hotNumbers.join(", ")}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">å†·é–€è™Ÿç¢¼</div>
      <div class="stat-value">${coldNumbers.join(", ")}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">é•·æœŸéºæ¼</div>
      <div class="stat-value">${sortedByMiss.join(", ")}</div>
    </div>
  `;
}

// ==================== æ™ºèƒ½åˆ†æå±¤ ====================
function runAnalysis() {
  if(data.length === 0) {
    alert("è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶");
    return;
  }
  
  showLoading("loadingA", true);
  
  setTimeout(() => {
    analysisCache = calculateAdvancedStats();
    displayAnalysisResults(analysisCache);
    showLoading("loadingA", false);
  }, 800);
}

function calculateAdvancedStats() {
  const totalDraws = data.length;
  const sums = data.map(d => d.numbers.reduce((a,b) => a+b, 0));
  const oddCounts = data.map(d => d.numbers.filter(n => n%2===1).length);
  
  return {
    totalDraws,
    avgSum: Math.round(sums.reduce((a,b) => a+b, 0) / sums.length),
    minSum: Math.min(...sums),
    maxSum: Math.max(...sums),
    avgOdd: Math.round(oddCounts.reduce((a,b) => a+b, 0) / oddCounts.length),
    numberStats
  };
}

function displayAnalysisResults(stats) {
  const container = document.getElementById("panelA");
  container.style.display = "block";
  
  // ç†±é–€è™Ÿç¢¼
  const hotNumbers = Object.entries(numberStats)
    .sort(([,a], [,b]) => b.count - a.count)
    .slice(0, 10)
    .map(([num]) => parseInt(num));
  
  // å†·é–€è™Ÿç¢¼
  const coldNumbers = Object.entries(numberStats)
    .sort(([,a], [,b]) => a.count - b.count)
    .slice(0, 10)
    .map(([num]) => parseInt(num));
  
  // é•·æœŸéºæ¼è™Ÿç¢¼
  const missedNumbers = Object.entries(numberStats)
    .filter(([,stat]) => stat.lastSeen > 20)
    .sort(([,a], [,b]) => b.lastSeen - a.lastSeen)
    .slice(0, 10)
    .map(([num]) => parseInt(num));
  
  container.innerHTML = `
    <div class="box">
      <div class="box-title">ğŸ”¥ ç†±é–€è™Ÿç¢¼ï¼ˆå‡ºç¾é »ç‡æœ€é«˜ï¼‰</div>
      <div class="numbers-grid">
        ${hotNumbers.map(num => `<div class="number-ball hot">${num}</div>`).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â„ï¸ å†·é–€è™Ÿç¢¼ï¼ˆå‡ºç¾é »ç‡æœ€ä½ï¼‰</div>
      <div class="numbers-grid">
        ${coldNumbers.map(num => `<div class="number-ball cold">${num}</div>`).join('')}
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">â³ é•·æœŸéºæ¼è™Ÿç¢¼ï¼ˆ>20æœŸï¼‰</div>
      ${missedNumbers.length > 0 ? `
        <div class="numbers-grid">
          ${missedNumbers.map(num => `<div class="number-ball missed">${num}</div>`).join('')}
        </div>
        <div class="status warning">é€™äº›è™Ÿç¢¼å·²è¶…é20æœŸæœªå‡ºç¾</div>
      ` : `
        <div class="status success">ç›®å‰æ²’æœ‰è™Ÿç¢¼éºæ¼è¶…é20æœŸ</div>
      `}
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ“Š çµ±è¨ˆæ‘˜è¦</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">ç¸½æœŸæ•¸</div>
          <div class="stat-value">${stats.totalDraws}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å’Œå€¼</div>
          <div class="stat-value">${stats.avgSum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å’Œå€¼ç¯„åœ</div>
          <div class="stat-value">${stats.minSum}-${stats.maxSum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å¹³å‡å¥‡æ•¸</div>
          <div class="stat-value">${stats.avgOdd}</div>
        </div>
      </div>
    </div>
  `;
}

// ==================== çµ„åˆé©—è­‰å±¤ ====================
function runVerify() {
  const input = document.getElementById("verifyInput").value.trim();
  if(!input) {
    alert("è«‹è¼¸å…¥è¦é©—è­‰çš„è™Ÿç¢¼çµ„åˆ");
    return;
  }
  
  const numbers = input.split(/\s+/).map(n => parseInt(n.trim()));
  if(numbers.length !== 5 || numbers.some(n => isNaN(n) || n < 1 || n > 39)) {
    alert("è«‹è¼¸å…¥5å€‹æœ‰æ•ˆçš„è™Ÿç¢¼ï¼ˆ1-39ä¹‹é–“ï¼‰");
    return;
  }
  
  if(new Set(numbers).size !== 5) {
    alert("è™Ÿç¢¼ä¸èƒ½é‡è¤‡");
    return;
  }
  
  const stats = analysisCache || calculateAdvancedStats();
  displayVerificationResults(numbers, stats);
}

function displayVerificationResults(numbers, stats) {
  const container = document.getElementById("panelB");
  container.style.display = "block";
  
  const sorted = [...numbers].sort((a,b) => a-b);
  const oddCount = numbers.filter(n => n%2===1).length;
  const sum = numbers.reduce((a,b) => a+b, 0);
  const span = Math.max(...numbers) - Math.min(...numbers);
  
  let overallStatus = "success";
  let message = "é€™æ˜¯ä¸€å€‹åˆç†çš„çµ„åˆ";
  
  // è©•ä¼°æ¢ä»¶
  if(Math.abs(oddCount - stats.avgOdd) > 2) {
    overallStatus = "warning";
    message = "å¥‡å¶æ¯”ä¾‹èˆ‡æ­·å²è¶¨å‹¢å·®ç•°è¼ƒå¤§";
  }
  
  if(sum < stats.minSum || sum > stats.maxSum) {
    overallStatus = "warning";
    message = "å’Œå€¼è¶…å‡ºæ­·å²ç¯„åœ";
  }
  
  if(span < 15) {
    overallStatus = "warning";
    message = "è™Ÿç¢¼è·¨åº¦åå°";
  }
  
  // å€‹åˆ¥è™Ÿç¢¼åˆ†æ
  const numberAnalysis = numbers.map(num => {
    const stat = numberStats[num];
    let status = "normal";
    let desc = "ä¸€èˆ¬";
    
    if(stat.count/stats.totalDraws > 0.12) {
      status = "hot";
      desc = "ç†±é–€";
    } else if(stat.count/stats.totalDraws < 0.05) {
      status = "cold";
      desc = "å†·é–€";
    }
    
    if(stat.lastSeen > 20) {
      status = "missed";
      desc = "é•·æœŸéºæ¼";
    }
    
    return {num, freq: (stat.count/stats.totalDraws).toFixed(3), missed: stat.lastSeen, status, desc};
  });
  
  container.innerHTML = `
    <div class="box">
      <div class="box-title">âœ… çµ„åˆé©—è­‰çµæœ</div>
      <div class="numbers-grid">
        ${sorted.map(num => `<div class="number-ball">${num}</div>`).join('')}
      </div>
      <div class="status ${overallStatus}">${message}</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶æ¯”ä¾‹</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼è·¨åº¦</div>
          <div class="stat-value">${span}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ­·å²å¹³å‡</div>
          <div class="stat-value">${stats.avgOdd}å¥‡</div>
        </div>
      </div>
    </div>
    
    <div class="box">
      <div class="box-title">ğŸ” å€‹åˆ¥è™Ÿç¢¼åˆ†æ</div>
      ${numberAnalysis.map(item => `
        <div class="stat-item" style="text-align: left; margin-bottom: 10px;">
          <div><strong>è™Ÿç¢¼ ${item.num}</strong></div>
          <div style="font-size: 0.9rem; color: #8da1b9;">
            é »ç‡: ${item.freq} | éºæ¼: ${item.missed}æœŸ | 
            ç‹€æ…‹: <span style="color: ${getStatusColor(item.status)}">${item.desc}</span>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

// ==================== é æ¸¬ç”Ÿæˆå±¤ ====================
function generateStandardPrediction() {
  generatePrediction('standard');
}

function generateAdvancedPrediction() {
  generatePrediction('advanced');
}

function generatePrediction(type = 'standard') {
  if(data.length === 0) {
    alert("è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶");
    return;
  }
  
  showLoading("loadingC", true);
  
  setTimeout(() => {
    const strategy = document.getElementById("strategySelect").value;
    const prediction = generatePredictionNumbers(strategy, type);
    displayPredictionResults(prediction, strategy, type);
    showLoading("loadingC", false);
  }, 600);
}

function generatePredictionNumbers(strategy, type = 'standard') {
  const stats = analysisCache || calculateAdvancedStats();
  let candidates = [];
  
  for(let num = 1; num <= 39; num++) {
    const stat = numberStats[num];
    const freqRatio = stat.count / stats.totalDraws;
    let score = 0;
    
    // æ ¹æ“šç­–ç•¥è¨ˆç®—åˆ†æ•¸
    switch(strategy) {
      case 'hot':
        score = freqRatio * 100 + (stat.lastSeen > 10 ? 10 : 0);
        break;
      case 'cold':
        score = (1 - freqRatio) * 100 + stat.lastSeen * 2;
        break;
      case 'pattern':
        score = 50 + (freqRatio * 50) + (stat.lastSeen > 15 ? 20 : 0);
        break;
      default: // balanced
        score = freqRatio * 60 + Math.min(stat.lastSeen, 20) * 2;
    }
    
    // é€²éšæ¨¡å¼è€ƒæ…®æ›´å¤šå› ç´ 
    if(type === 'advanced') {
      score += stat.consecutivePairs * 5;
    }
    
    candidates.push({num, score});
  }
  
  // æŒ‰åˆ†æ•¸æ’åº
  candidates.sort((a,b) => b.score - a.score);
  
  // é¸æ“‡5å€‹è™Ÿç¢¼ï¼Œç¢ºä¿å¤šæ¨£æ€§
  const selected = [];
  let oddCount = 0;
  const targetOdd = Math.floor(Math.random() * 3) + 2; // 2-4å€‹å¥‡æ•¸
  
  for(let candidate of candidates) {
    if(selected.length >= 5) break;
    
    const isOdd = candidate.num % 2 === 1;
    if(isOdd && oddCount >= targetOdd) continue;
    
    // æª¢æŸ¥æ˜¯å¦å¤ªæ¥è¿‘å·²é¸è™Ÿç¢¼
    let tooClose = false;
    for(let selectedNum of selected) {
      if(Math.abs(candidate.num - selectedNum) < 5) {
        tooClose = true;
        break;
      }
    }
    
    if(!tooClose) {
      selected.push(candidate.num);
      if(isOdd) oddCount++;
    }
  }
  
  // å¦‚æœä¸å¤ 5å€‹ï¼Œè£œé½Š
  while(selected.length < 5) {
    for(let i = 1; i <= 39; i++) {
      if(!selected.includes(i)) {
        selected.push(i);
        break;
      }
    }
  }
  
  return selected.sort((a,b) => a-b);
}

function displayPredictionResults(numbers, strategy, type) {
  const container = document.getElementById("panelC");
  container.style.display = "block";
  
  const oddCount = numbers.filter(n => n%2===1).length;
  const sum = numbers.reduce((a,b) => a+b, 0);
  const span = Math.max(...numbers) - Math.min(...numbers);
  
  const strategyNames = {
    'balanced': 'å‡è¡¡ç­–ç•¥',
    'hot': 'ç†±é–€ç­–ç•¥',
    'cold': 'å†·é–€ç­–ç•¥',
    'pattern': 'æ¨¡å¼ç­–ç•¥'
  };
  
  container.innerHTML = `
    <div class="box">
      <div class="box-title">ğŸ¯ ${type === 'advanced' ? 'é€²éš' : 'æ¨™æº–'}é æ¸¬çµæœ</div>
      <div class="numbers-grid">
        ${numbers.map(num => `<div class="number-ball" style="background: linear-gradient(135deg, #00ff99, #00cc7a);">${num}</div>`).join('')}
      </div>
      <div class="status success">âœ… ä½¿ç”¨ç­–ç•¥ï¼š${strategyNames[strategy]} | é¡å‹ï¼š${type === 'advanced' ? 'é€²éšæ¨¡å¼' : 'æ¨™æº–æ¨¡å¼'}</div>
      <div class="stats-row">
        <div class="stat-item">
          <div class="stat-label">å¥‡å¶æ¯”ä¾‹</div>
          <div class="stat-value">${oddCount}å¥‡${5-oddCount}å¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼ç¸½å’Œ</div>
          <div class="stat-value">${sum}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è™Ÿç¢¼è·¨åº¦</div>
          <div class="stat-value">${span}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ç­–ç•¥é¡å‹</div>
          <div class="stat-value">${strategyNames[strategy]}</div>
        </div>
      </div>
    </div>
  `;
}

// ==================== å…¨è»Šè™Ÿç¢¼é æ¸¬å±¤ ====================
function generateFullCarByFrequency() {
  generateFullCarNumbers('frequency');
}

function generateFullCarByMissed() {
  generateFullCarNumbers('missed');
}

function generateFullCarNumbers(mode = 'frequency') {
  if(data.length === 0) {
    alert("è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶");
    return;
  }
  
  showLoading("loadingD", true);
  
  setTimeout(() => {
    const allNumbers = Array.from({length: 39}, (_, i) => i + 1);
    let sortedNumbers;
    
    if(mode === 'missed') {
      // æŒ‰éºæ¼æœŸæ•¸æ’åºï¼ˆéºæ¼æœ€ä¹…çš„å„ªå…ˆï¼‰
      sortedNumbers = [...allNumbers].sort((a,b) => 
        numberStats[b].lastSeen - numberStats[a].lastSeen
      );
    } else {
      // æŒ‰å‡ºç¾é »ç‡æ’åºï¼ˆé »ç‡æœ€é«˜çš„å„ªå…ˆï¼‰
      sortedNumbers = [...allNumbers].sort((a,b) => 
        numberStats[b].count - numberStats[a].count
      );
    }
    
    displayFullCarNumbers(sortedNumbers, mode);
    showLoading("loadingD", false);
  }, 500);
}

function displayFullCarNumbers(numbers, mode) {
  const container = document.getElementById("panelD");
  container.style.display = "block";
  
  const modeNames = {
    'frequency': 'æŒ‰å‡ºç¾é »ç‡æ’åº',
    'missed': 'æŒ‰éºæ¼æœŸæ•¸æ’åº'
  };
  
  // åˆ†çµ„é¡¯ç¤ºï¼ˆæ¯è¡Œ10å€‹è™Ÿç¢¼ï¼‰
  const groups = [];
  for(let i = 0; i < numbers.length; i += 10) {
    groups.push(numbers.slice(i, i + 10));
  }
  
  container.innerHTML = `
    <div class="box">
      <div class="box-title">ğŸš— å…¨è»Šè™Ÿç¢¼é æ¸¬ - ${modeNames[mode]}</div>
      ${groups.map((group, idx) => `
        <div style="margin: 15px 0;">
          <div style="color: var(--info); margin-bottom: 8px;">ç¬¬${idx*10+1}-${Math.min((idx+1)*10, 39)}è™Ÿï¼š</div>
          <div class="numbers-grid">
            ${group.map(num => `
              <div class="number-ball" title="å‡ºç¾:${numberStats[num].count}æ¬¡ éºæ¼:${numberStats[num].lastSeen}æœŸ">
                ${num}
              </div>
            `).join('')}
          </div>
        </div>
      `).join('')}
      <div class="status info">
        ğŸ’¡ æç¤ºï¼š${mode === 'frequency' ? 
          'è™Ÿç¢¼æŒ‰æ­·å²å‡ºç¾é »ç‡æ’åºï¼Œè¶Šå‰é¢çš„è™Ÿç¢¼åœ¨æ­·å²ä¸Šå‡ºç¾æ¬¡æ•¸è¶Šå¤š' : 
          'è™Ÿç¢¼æŒ‰éºæ¼æœŸæ•¸æ’åºï¼Œè¶Šå‰é¢çš„è™Ÿç¢¼å·²ç¶“è¶Šä¹…æ²’æœ‰é–‹å‡º'}
      </div>
    </div>
  `;
}

function generateMultiplePredictions() {
  if(data.length === 0) {
    alert("è«‹å…ˆä¸Šè¼‰æ•¸æ“šæ–‡ä»¶");
    return;
  }
  
  showLoading("loadingD", true);
  
  setTimeout(() => {
    const strategies = ['balanced', 'hot', 'cold', 'pattern'];
    const predictions = [];
    
    // ç”Ÿæˆ4ç¨®ç­–ç•¥çš„é æ¸¬
    strategies.forEach(strategy => {
      predictions.push({
        strategy,
        numbers: generatePredictionNumbers(strategy, 'advanced')
      });
    });
    
    displayMultiplePredictions(predictions);
    showLoading("loadingD", false);
  }, 800);
}

function displayMultiplePredictions(predictions) {
  const container = document.getElementById("panelD");
  container.style.display = "block";
  
  const strategyNames = {
    'balanced': 'å‡è¡¡ç­–ç•¥',
    'hot': 'ç†±é–€ç­–ç•¥',
    'cold': 'å†·é–€ç­–ç•¥',
    'pattern': 'æ¨¡å¼ç­–ç•¥'
  };
  
  container.innerHTML = `
    <div class="box">
      <div class="box-title">ğŸ² å¤šç­–ç•¥é æ¸¬çµ„åˆ</div>
      <div class="predictions-container">
        ${predictions.map(pred => `
          <div class="prediction-card">
            <div class="prediction-title">${strategyNames[pred.strategy]}</div>
            <div class="numbers-grid" style="grid-template-columns: repeat(5, 1fr);">
              ${pred.numbers.map(num => `<div class="number-ball">${num}</div>`).join('')}
            </div>
            <div style="font-size: 0.8rem; color: #8da1b9; margin-top: 8px; text-align: center;">
              å¥‡å¶: ${pred.numbers.filter(n => n%2===1).length}å¥‡ | 
              å’Œå€¼: ${pred.numbers.reduce((a,b) => a+b, 0)}
            </div>
          </div>
        `).join('')}
      </div>
      <div class="status info">
        ğŸ’¡ æç¤ºï¼šçµåˆå¤šç¨®ç­–ç•¥çš„é æ¸¬çµæœé€²è¡Œåƒè€ƒï¼Œå¯ä»¥æé«˜åˆ†æçš„å…¨é¢æ€§
      </div>
    </div>
  `;
}

// ==================== å·¥å…·å‡½æ•¸ ====================
function showStatus(id, msg, type = "info") {
  document.getElementById(id).innerHTML = `<div class="status ${type}">${msg}</div>`;
}

function showLoading(id, show) {
  document.getElementById(id).style.display = show ? "block" : "none";
}

function getStatusColor(status) {
  switch(status) {
    case "hot": return "#ff6666";
    case "cold": return "#4fc3f7";
    case "missed": return "#ffcc00";
    default: return "#8da1b9";
  }
}
</script>
</body>
</html>
