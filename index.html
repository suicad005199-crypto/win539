<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Office Royale: 30 Days</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2c3e50; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Arial', sans-serif; }
        
        /* çš‡å®¤æˆ°çˆ­é¢¨æ ¼ UI */
        #game-container { position: relative; border: 8px solid #5d4037; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #ui-header { 
            position: absolute; top: 0; width: 100%; height: 60px; 
            background: linear-gradient(to bottom, #8d6e63, #5d4037);
            display: flex; justify-content: center; align-items: center;
            border-bottom: 4px solid #3e2723; z-index: 10;
        }

        .day-badge {
            background: #f44336; color: white; padding: 5px 20px;
            border-radius: 10px; border: 3px solid #ffc107;
            font-weight: 900; font-size: 20px; box-shadow: 0 4px 0 #b71c1c;
        }

        #progress-container {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 80%; height: 15px; background: #3e2723;
            border-radius: 10px; border: 3px solid #795548; z-index: 10;
        }
        #progress-bar { width: 0%; height: 100%; background: #4caf50; border-radius: 5px; transition: 0.3s; }

        canvas { background: #9e9e9e; display: block; cursor: pointer; touch-action: none; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-header">
        <div class="day-badge">DAY <span id="day-val">1</span> / 30</div>
    </div>
    <div id="progress-container"><div id="progress-bar"></div></div>
    <canvas id="game"></canvas>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 360; canvas.height = 640;

// --- é€Ÿåº¦åƒæ•¸ (ç¶­æŒç”¨æˆ¶æŒ‡å®š) ---
const CFG = {
    P_SPD: 850,
    E_TYPES: [
        { n: 'ä¸»ç®¡', c: '#ff5252', s: 1000, sz: 60, icon: 'ðŸ§›' },
        { n: 'æ”¹ç¨¿', c: '#ffab40', s: 1500, sz: 50, icon: 'ðŸ“œ' },
        { n: 'æœƒè­°', c: '#ffd740', s: 2300, sz: 40, icon: 'â°' }
    ],
    AMBUSH_SPD: 2500
};

let day = 1, progress = 0, isPaused = false, lastT = 0;
let player = { x: 150, y: 540, w: 60, h: 60, isFiring: false };
let enemies = [];

// éŸ³æ•ˆ (è–æ°´é¢¨æ ¼)
const audio = new (window.AudioContext || window.webkitAudioContext)();
function playSound(f, t, d) {
    if(audio.state === 'suspended') audio.resume();
    const o = audio.createOscillator(), g = audio.createGain();
    o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
    g.gain.setValueAtTime(0.1, audio.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + d);
    o.connect(g); g.connect(audio.destination);
    o.start(); o.stop(audio.currentTime + d);
}

function spawn(isAmbush = false, sideInput = null) {
    const type = isAmbush ? CFG.E_TYPES[2] : CFG.E_TYPES[Math.floor(Math.random()*3)];
    const side = sideInput || (Math.random() > 0.5 ? 1 : -1);
    enemies.push({
        x: side === 1 ? -120 : 480,
        y: 100 + Math.random() * 320,
        vx: (isAmbush ? CFG.AMBUSH_SPD : type.s) * side,
        var: Math.random() * 2, // ç”¨æ–¼å¿½å¿«å¿½æ…¢çš„ä½ç§»
        ...type
    });
}

setInterval(() => { if(!isPaused) spawn(); }, 280);

function update(dt) {
    if (isPaused) return;

    if (player.isFiring) {
        player.y -= CFG.P_SPD * dt;
        if (player.y < 50) {
            progress++;
            playSound(1000, 'sine', 0.2);
            if (progress >= 2) { day++; progress = 0; }
            reset();
        }
    }

    enemies.forEach((e, i) => {
        // å¿½å¿«å¿½æ…¢æ•ˆæžœ (Sine æ³¢å½¢æ“¾å‹•)
        const wave = Math.sin(Date.now() / 150 + e.var) * 100;
        e.x += (e.vx + wave) * dt;

        if (player.isFiring && player.x < e.x + e.sz && player.x + player.w > e.x && player.y < e.y + e.sz && player.y + player.h > e.y) {
            playSound(150, 'square', 0.3);
            reset();
        }
        if (e.x < -300 || e.x > 600) enemies.splice(i, 1);
    });

    document.getElementById('day-val').innerText = day;
    document.getElementById('progress-bar').style.width = (progress / 2) * 100 + "%";
}

function reset() { player.y = 540; player.isFiring = false; }

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // è¾¦å…¬å®¤é¦¬è·¯èƒŒæ™¯
    ctx.fillStyle = "#78909c"; // åœ°æ¯¯ç°è‰²
    ctx.fillRect(0,0,360,640);
    // åˆ†é“ç·š
    ctx.strokeStyle = "rgba(255,255,255,0.5)";
    ctx.lineWidth = 4;
    ctx.setLineDash([20, 20]);
    ctx.beginPath(); ctx.moveTo(120,0); ctx.lineTo(120,640); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(240,0); ctx.lineTo(240,640); ctx.stroke();
    ctx.setLineDash([]);

    // æ•µäºº (å¡ç‰ŒåŒ–)
    enemies.forEach(e => {
        // å¡ç‰Œé™°å½±
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.fillRect(e.x + 4, e.y + 4, e.sz, e.sz);
        // å¡ç‰Œä¸»é«”
        ctx.fillStyle = "#fff";
        ctx.strokeStyle = e.c;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.roundRect(e.x, e.y, e.sz, e.sz, 8);
        ctx.fill(); ctx.stroke();
        // åœ–ç¤ºèˆ‡æ–‡å­—
        ctx.fillStyle = "#3e2723";
        ctx.font = `bold ${e.sz*0.4}px Arial`;
        ctx.textAlign = "center";
        ctx.fillText(e.icon, e.x + e.sz/2, e.y + e.sz*0.45);
        ctx.font = `bold ${e.sz*0.25}px Arial`;
        ctx.fillText(e.n, e.x + e.sz/2, e.y + e.sz*0.8);
    });

    // çŽ©å®¶ (è–æ°´å°å…µ)
    ctx.fillStyle = "#ffeb3b";
    ctx.strokeStyle = "#f57f17";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.roundRect(player.x, player.y, player.w, player.h, 12);
    ctx.fill(); ctx.stroke();
    ctx.fillStyle = "#3e2723";
    ctx.font = "bold 24px Arial";
    ctx.fillText("æˆ‘", player.x + player.w/2, player.y + player.h/2 + 8);
    
    // è–æ°´ç‰¹æ•ˆ
    if(player.isFiring) {
        ctx.shadowBlur = 15; ctx.shadowColor = "#00bcd4";
        ctx.fillStyle = "rgba(0, 188, 212, 0.5)";
        ctx.fillRect(player.x, player.y + player.h, player.w, 20);
        ctx.shadowBlur = 0;
    }
}

function loop(t) {
    let dt = (t - lastT) / 1000;
    lastT = t;
    update(dt > 0.1 ? 0 : dt);
    draw();
    requestAnimationFrame(loop);
}

const launch = () => {
    if(!player.isFiring && !isPaused) {
        player.isFiring = true;
        playSound(600, 'triangle', 0.1);
        if(Math.random() < 0.4) {
            const m = Math.floor(Math.random()*3);
            if(m===0){ spawn(true, 1); spawn(true, 1); }
            else if(m===1){ spawn(true, -1); spawn(true, -1); }
            else { spawn(true, 1); spawn(true, -1); }
        }
    }
};

canvas.addEventListener('mousedown', launch);
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); launch(); });
requestAnimationFrame(loop);
</script>
</body>
</html>
