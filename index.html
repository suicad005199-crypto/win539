function getV430Prediction(hist) {
    if(hist.length < 20) return [1,2,3,4,5,6,7,8];
    let stats = Array(40).fill(0).map((_, i) => ({ n: i, score: 0 }));
    const lastRow = hist[hist.length-1].nums;
    const recentDraws = hist.slice(-10);

    // A. 遺漏值 (Gap) 權重優化：針對「中短期遺漏」給予最高分
    for(let i=1; i<=39; i++) {
        let gap = 0;
        for(let k=hist.length-1; k>=0; k--) {
            if(!hist[k].nums.includes(i)) gap++; else break;
        }
        if (gap === 0) stats[i].score += 18;       // 連莊號加分
        else if (gap <= 5) stats[i].score += 25;  // 熱門號加分
        else if (gap > 20) stats[i].score -= 10;  // 極冷號扣分
    }

    // B. 強勢尾數分析 (強化 2 星關鍵)
    let tailCount = Array(10).fill(0);
    recentDraws.forEach(d => d.nums.forEach(n => tailCount[n%10]++));
    let topTails = tailCount.map((c, i) => ({t: i, c})).sort((a,b)=>b.c - a.c).slice(0, 3).map(x=>x.t);
    
    for(let i=1; i<=39; i++) {
        if(topTails.includes(i%10)) stats[i].score += 15;
    }

    // C. 鄰碼與斜連號 (增加覆蓋率)
    lastRow.forEach(ln => {
        if(ln > 1) stats[ln-1].score += 22;
        if(ln < 39) stats[ln+1].score += 22;
    });

    // D. 綜合排序選號 (取消分區強硬限制，改採全局前 12 碼篩選)
    let top12 = stats.slice(1).sort((a,b)=>b.score - a.score).slice(0, 12);
    
    // 從前 12 碼中篩選出分布最均勻的 8 碼
    return top12.sort((a,b)=>a.n - b.n).slice(0, 8).map(x=>x.n);
}
