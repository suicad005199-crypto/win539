<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Office Royale Mobile</title>
    <style>
        /* å…¨è¢å¹• iOS é©é… */
        body { 
            margin: 0; overflow: hidden; background: #000; 
            display: flex; flex-direction: column; height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica;
        }
        
        /* æˆªåœ–ä¸­çš„é ‚éƒ¨ç´…è‰²ç‹€æ…‹åˆ— */
        #ios-header { 
            width: 100%; height: 65px; background: #ff4d4d;
            display: flex; justify-content: center; align-items: flex-end;
            padding-bottom: 8px; box-sizing: border-box;
            border-bottom: 4px solid #333; z-index: 20;
        }

        .day-display {
            color: white; font-size: 22px; font-weight: 800;
            display: flex; align-items: center; gap: 8px;
        }

        /* ç•«å¸ƒé©é…ï¼šå¡«æ»¿å‰©é¤˜ç©ºé–“ */
        #canvas-wrap { flex: 1; position: relative; background: #f0f0f0; width: 100%; }
        canvas { width: 100% !important; height: 100% !important; display: block; touch-action: none; }

        /* è–æ°´èƒ½é‡æ¢ï¼šç½®åº•æ–¼é»‘è‰²å°èˆªåˆ—ä¸Šæ–¹ */
        #bottom-ui {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 85%; z-index: 30; pointer-events: none;
        }
        #elixir-bg { 
            width: 100%; height: 14px; background: rgba(0,0,0,0.6); 
            border-radius: 10px; border: 2px solid #546e7a; overflow: hidden;
        }
        #elixir-fill { 
            width: 0%; height: 100%; 
            background: linear-gradient(90deg, #ea80fc, #e040fb); 
            box-shadow: 0 0 10px #e040fb;
        }
    </style>
</head>
<body>

<div id="ios-header">
    <div class="day-display">ğŸ“… DAY <span id="day-val">1</span> / 30</div>
</div>

<div id="canvas-wrap">
    <canvas id="game"></canvas>
    <div id="bottom-ui">
        <div id="elixir-bg"><div id="elixir-fill"></div></div>
    </div>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// è‡ªå‹•åµæ¸¬å…¨è¢å¹•å°ºå¯¸
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight - 65; // æ‰£é™¤é ‚éƒ¨é«˜åº¦
}
window.addEventListener('resize', resize);
resize();

// ç´ æèˆ‡é…ç½®
const IMG_URLS = {
    me: 'https://openmoji.org/data/color/svg/1F3C3.svg',
    boss: 'https://openmoji.org/data/color/svg/1F47A.svg',
    edit: 'https://openmoji.org/data/color/svg/1F4DC.svg',
    meet: 'https://openmoji.org/data/color/svg/23F0.svg'
};
const imgs = {};
Object.entries(IMG_URLS).forEach(([k, s]) => { imgs[k] = new Image(); imgs[k].src = s; });

const CFG = {
    P_SPD: 900,
    E_BASE: [
        { n: 'ä¸»ç®¡', c: '#ff5252', s: 1000, sz: 65, img: 'boss' },
        { n: 'æ”¹ç¨¿', c: '#ffab40', s: 1500, sz: 55, img: 'edit' },
        { n: 'æœƒè­°', c: '#ffd740', s: 2300, sz: 45, img: 'meet' }
    ]
};

let day = 1, progress = 0, lastT = performance.now();
let player = { x: canvas.width/2 - 30, y: canvas.height - 120, w: 60, h: 60, isFiring: false };
let elixir = 100;
let enemies = [];

function spawn(isAmbush = false, side = null) {
    const type = isAmbush ? CFG.E_BASE[2] : CFG.E_BASE[Math.floor(Math.random()*3)];
    const s = side || (Math.random() > 0.5 ? 1 : -1);
    enemies.push({
        x: s === 1 ? -100 : canvas.width + 100,
        y: 80 + Math.random() * (canvas.height - 250),
        vx: (isAmbush ? 2600 : type.s) * s,
        vVar: Math.random() * 5,
        ...type
    });
}
setInterval(() => { if(!player.isFiring) spawn(); }, 320);

function update(dt) {
    if (!player.isFiring) elixir = Math.min(100, elixir + dt * 50);
    document.getElementById('elixir-fill').style.width = elixir + '%';

    if (player.isFiring) {
        player.y -= CFG.P_SPD * dt;
        if (player.y < -60) {
            progress++;
            if (progress >= 2) { day++; progress = 0; }
            reset();
        }
    }

    enemies.forEach((e, i) => {
        const wave = Math.sin(Date.now() / 180 + e.vVar) * 130;
        e.x += (e.vx + wave) * dt;
        if (player.isFiring && player.x < e.x + e.sz - 12 && player.x + player.w > e.x + 12 && 
            player.y < e.y + e.sz - 12 && player.y + player.h > e.y + 12) reset();
        if (e.x < -300 || e.x > canvas.width + 300) enemies.splice(i, 1);
    });
    document.getElementById('day-val').innerText = day;
}

function reset() { 
    player.y = canvas.height - 120; 
    player.isFiring = false; 
    elixir = 0; 
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // èƒŒæ™¯ï¼šç°¡æ½”æ·ºç°é“è·¯
    ctx.fillStyle = "#f0f0f0"; ctx.fillRect(0,0,canvas.width,canvas.height);
    
    // æ•µäººç¹ªè£½
    enemies.forEach(e => {
        ctx.fillStyle = "rgba(0,0,0,0.1)";
        ctx.beginPath(); ctx.ellipse(e.x + e.sz/2, e.y + e.sz, e.sz/2, 8, 0, 0, Math.PI*2); ctx.fill();
        if(imgs[e.img]) ctx.drawImage(imgs[e.img], e.x, e.y, e.sz, e.sz);
    });

    // ç©å®¶ç¹ªè£½
    if(imgs.me) ctx.drawImage(imgs.me, player.x, player.y, player.w, player.h);
}

function loop(t) {
    let dt = (t - lastT) / 1000;
    lastT = t;
    update(dt > 0.1 ? 0 : dt);
    draw();
    requestAnimationFrame(loop);
}

const launch = (e) => {
    e.preventDefault();
    if(!player.isFiring && elixir >= 90) {
        player.isFiring = true;
        if(Math.random() < 0.45) { spawn(true, 1); spawn(true, -1); }
    }
};

canvas.addEventListener('touchstart', launch);
canvas.addEventListener('mousedown', launch);
requestAnimationFrame(loop);
</script>
</body>
</html>
