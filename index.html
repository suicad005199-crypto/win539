<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --ios-blue: #007AFF; --ios-red: #FF3B30; --ios-green: #4CD964; }
        body { margin: 0; background: #111; color: white; font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
        #status { width: 90vw; max-width: 400px; display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 3px; width: 95vw; max-width: 450px; background: #333; padding: 5px; border-radius: 12px; }
        .cell { aspect-ratio: 1; background: #000; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; transition: background 0.3s; }
        /* è¿·éœ§æ•ˆæœ */
        .fog { opacity: 0; }
        .visible { opacity: 1; background: #444; }
        .player { background: var(--ios-blue) !important; z-index: 2; box-shadow: 0 0 10px var(--ios-blue); }
        .buff { color: #FFD700; } .heal { color: var(--ios-green); }
    </style>
</head>
<body>

<div id="status">
    <span>HP: <span id="hp">100</span></span>
    <span>ATK: <span id="atk">10</span></span>
    <span>LV: <span id="lv">1</span></span>
</div>

<div class="grid" id="grid"></div>

<script>
    const gridEl = document.getElementById('grid');
    const stats = { hp: 100, atk: 10, lv: 1 };
    let playerPos = 0;
    let mapData = [];

    function init() {
        // ç”Ÿæˆåœ°åœ–è³‡æ–™
        const types = ['B', 'P', ...Array(10).fill('H'), ...Array(10).fill('S'), ...Array(42).fill('M')];
        mapData = types.sort(() => Math.random() - 0.5);
        playerPos = mapData.indexOf('P');
        render();
    }

    function render() {
        gridEl.innerHTML = '';
        mapData.forEach((type, i) => {
            const cell = document.createElement('div');
            const dist = getDist(playerPos, i);
            cell.className = `cell ${dist <= 1 ? 'visible' : 'fog'}`;
            
            if (i === playerPos) {
                cell.classList.add('player');
                cell.innerHTML = 'ğŸ‘¤';
            } else if (dist <= 1) {
                if (type === 'M') cell.innerHTML = 'ğŸ‘¾';
                else if (type === 'B') cell.innerHTML = 'ğŸ‘¹';
                else if (type === 'H') cell.innerHTML = 'â¤ï¸';
                else if (type === 'S') cell.innerHTML = 'âš¡';
            }
            
            cell.onclick = () => move(i);
            gridEl.appendChild(cell);
        });
        updateStats();
    }

    function move(target) {
        if (getDist(playerPos, target) !== 1) return;

        const event = mapData[target];
        if (event === 'M' || event === 'B') {
            const isBoss = event === 'B';
            const risk = Math.random() > 0.7; // 30% æ©Ÿç‡é‡åˆ°å¼·æ•µ
            const damage = (isBoss ? 50 : (risk ? 30 : 10));
            
            if (confirm(`${isBoss ? 'BOSS' : (risk ? 'å¼·æ•µ' : 'å°æ€ª')}å‡ºç¾ï¼å—å‚· ${damage}ï¼Œç¢ºèªæˆ°é¬¥ï¼Ÿ`)) {
                stats.hp -= damage;
                stats.lv += 1;
                stats.atk += 2;
            } else return;
        } else if (event === 'H') {
            stats.hp += 20;
            alert("å–ä¸‹è—¥æ°´ï¼ŒHP+20");
        } else if (event === 'S') {
            stats.atk += 5;
            alert("ç²å¾— Buffï¼ŒATK+5");
        }

        if (stats.hp <= 0) {
            alert("ä½ æ­»äº†ï¼éŠæˆ²é‡ç½®");
            location.reload();
        }

        mapData[playerPos] = 'E'; // åŸä½è®Šç©ºæ ¼
        playerPos = target;
        mapData[playerPos] = 'P';
        render();
    }

    function getDist(p1, p2) {
        const x1 = p1 % 8, y1 = Math.floor(p1 / 8);
        const x2 = p2 % 8, y2 = Math.floor(p2 / 8);
        return Math.abs(x1 - x2) + Math.abs(y1 - y2);
    }

    function updateStats() {
        document.getElementById('hp').innerText = stats.hp;
        document.getElementById('atk').innerText = stats.atk;
        document.getElementById('lv').innerText = stats.lv;
    }

    init();
</script>
</body>
</html>
