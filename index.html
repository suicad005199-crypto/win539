<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>539 æ¥µé™åˆ†æ V.42.9x</title>
    <style>
        :root { --bg: #050505; --panel: #161618; --primary: #ffd60a; --hit: #ff375f; --text: #fff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 10px; }
        .panel { background: var(--panel); border-radius: 12px; padding: 15px; border: 1px solid #333; margin-bottom: 10px; }
        .ball-row { display: flex; gap: 8px; justify-content: center; }
        .ball { width: 40px; height: 40px; background: #222; border: 2px solid var(--hit); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--hit); font-size: 18px; }
        .n-box { width: 22px; height: 22px; background: #222; display: inline-flex; align-items: center; justify-content: center; margin: 2px; font-size: 11px; border-radius: 4px; }
        .n-box.hit { background: var(--primary); color: #000; font-weight: bold; }
        .star { background: #32d74b; color: #000; padding: 2px 6px; border-radius: 4px; font-weight: bold; float: right; }
    </style>
</head>
<body>
    <div class="panel">æ³¨å…¥ CSVï¼š<input type="file" id="f"></div>
    <div class="panel"><h3>ä¸‹æœŸæ¥µé™é æ¸¬</h3><div id="next" class="ball-row"></div></div>
    <div id="bt"></div>
<script>
    document.getElementById('f').addEventListener('change', e => {
        const r = new FileReader();
        r.onload = () => {
            const lines = r.result.replace(/\r/g, "").split('\n').filter(l => l.trim() !== "");
            const headers = lines[0].split(',').map(h => h.trim().replace(/^\ufeff/, ""));
            const j1 = headers.indexOf("çè™Ÿ1"), dt = headers.indexOf("é–‹çæ—¥æœŸ");
            const data = lines.slice(1).map(l => {
                const c = l.split(',');
                return { d: c[dt], nums: [parseInt(c[j1]), parseInt(c[j1+1]), parseInt(c[j1+2]), parseInt(c[j1+3]), parseInt(c[j1+4])].sort((a,b)=>a-b) };
            }).filter(x => x && !x.nums.some(isNaN));
            
            const runPred = (hist) => {
                let stats = Array(40).fill(0).map((_, i) => ({ n: i, score: 0 }));
                // æ¥µé™é‚è¼¯ï¼šå¤§å¹…å¼·åŒ–ç†±å°¾èˆ‡éºæ¼ 2-5 æœŸçš„é€£è™Ÿ
                let tm = Array(10).fill(0);
                hist.slice(-15).forEach(row => row.nums.forEach(n => tm[n%10]++));
                for(let i=1; i<=39; i++) {
                    let g = 0;
                    for(let k=hist.length-1; k>=0; k--) { if(!hist[k].nums.includes(i)) g++; else break; }
                    stats[i].score = (g >= 2 && g <= 6) ? 100 : g; // è¿½é€çˆ†ç™¼æº«ç¢¼
                    stats[i].score += tm[i%10] * 12; // å°¾æ•¸æ¥µé™æ¬Šé‡
                }
                // é„°è™Ÿé€£å‹•
                hist[hist.length-1].nums.forEach(n => {
                    if(n>1) stats[n-1].score += 40;
                    if(n<39) stats[n+1].score += 40;
                });
                return stats.filter(x=>x.n>0).sort((a,b)=>b.score - a.score).slice(0, 8).map(x=>x.n).sort((a,b)=>a-b);
            };

            const bt = document.getElementById('bt'); bt.innerHTML = "";
            data.slice(-10).reverse().forEach(row => {
                const pred = runPred(data.slice(0, data.indexOf(row)));
                const hits = row.nums.filter(n => pred.includes(n));
                bt.innerHTML += `<div class="panel">ğŸ“… ${row.d} <span class="star">${hits.length}â˜…</span><br>${row.nums.map(n => `<div class="n-box ${pred.includes(n)?'hit':''}">${n}</div>`).join('')}</div>`;
            });
            const nx = runPred(data);
            document.getElementById('next').innerHTML = nx.map(n => `<div class="ball">${n}</div>`).join('');
        };
        r.readAsText(e.target.files[0]);
    });
</script>
</body>
</html>
