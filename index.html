<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>邏輯逆向驗證</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #F2F2F7; padding: 15px; margin: 0; }
        .header { background: #007AFF; color: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; text-align: center; }
        .input-group { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border-left: 6px solid #34C759; }
        .num-label { font-size: 24px; font-weight: bold; color: #1C1C1E; }
        .logic-desc { font-size: 14px; color: #636366; margin-top: 5px; line-height: 1.4; }
        .source-tag { display: inline-block; background: #E5E5EA; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-top: 5px; }
        input[type="file"] { width: 100%; }
    </style>
</head>
<body>

<div class="header">
    <strong>1, 33, 16, 35, 2</strong><br>數據來源分析面板
</div>

<div class="input-group">
    <label>請上傳 CSV 數據檔案：</label><br><br>
    <input type="file" id="csvInput" accept=".csv">
</div>

<div id="panel"></div>

<script>
    const targets = [1, 33, 16, 35, 2];
    document.getElementById('csvInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const lines = event.target.result.split('\n').filter(l => l.trim() !== '');
            const data = lines.map(line => line.split(',').map(val => parseFloat(val.trim())));
            analyze(data);
        };
        reader.readAsText(e.target.files[0]);
    });

    function analyze(data) {
        const panel = document.getElementById('panel');
        panel.innerHTML = '';
        
        targets.forEach(target => {
            let matches = [];
            
            // 遍歷所有列與欄進行基礎統計比對
            for (let col = 0; col < data[0].length; col++) {
                const columnData = data.map(row => row[col]).filter(v => !isNaN(v));
                if (columnData.length === 0) continue;

                // 1. 檢查是否為最大值
                if (Math.max(...columnData) === target) matches.push(`第 ${col+1} 欄的「最大值」`);
                // 2. 檢查是否為出現頻率最高
                const counts = columnData.reduce((a, b) => (a[b] = (a[b] || 0) + 1, a), {});
                const topVal = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
                if (parseFloat(topVal) === target) matches.push(`第 ${col+1} 欄的「最常出現號碼」`);
                // 3. 檢查最後一筆更新
                if (columnData[columnData.length - 1] === target) matches.push(`第 ${col+1} 欄的「最新數值」`);
            }

            const html = `
                <div class="card">
                    <div class="num-label">${target}</div>
                    <div class="logic-desc">
                        ${matches.length > 0 ? matches.map(m => `• 符合：${m}`).join('<br>') : '未偵測到簡單規律，可能涉及多欄位運算。'}
                    </div>
                    <div class="source-tag">邏輯驗證完成</div>
                </div>
            `;
            panel.innerHTML += html;
        });
    }
</script>

</body>
</html>
