<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle V.72.3 - çœŸå¯¦çµ±è¨ˆä¿®æ­£ç‰ˆ</title>
    <style>
        :root { --bg: #050505; --card: #121212; --gold: #ffd700; --539: #00f2ff; --daily: #00ff88; }
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; margin: 0; padding: 10px; padding-bottom: 120px; }
        .log-box { background: #000; border: 1px solid #333; font-family: monospace; font-size: 11px; padding: 10px; height: 90px; overflow-y: auto; color: #0f0; border-radius: 5px; line-height: 1.5; }
        .history-panel { background: var(--card); border-radius: 10px; padding: 12px; margin-bottom: 15px; border: 1px solid #333; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { color: #888; text-align: left; padding-bottom: 8px; border-bottom: 1px solid #333; }
        td { padding: 8px 0; border-bottom: 1px solid #222; }
        .hit-num { color: var(--daily); font-weight: bold; background: rgba(0,255,136,0.1); padding: 0 2px; }
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: #000; padding: 15px; border-top: 1px solid #333; }
        .btn-upload { width: 100%; padding: 15px; border-radius: 10px; background: #fff; color: #000; font-weight: bold; border: none; font-size: 16px; }
    </style>
</head>
<body>

<div class="log-box" id="logBox">>> V.72.3 æ•¸æ“šå¼•æ“å·²å°±ç·’ã€‚æ‹’çµ•æ¨¡æ“¬ï¼Œåƒ…æ¥æ”¶çœŸå¯¦ CSVã€‚</div>

<div class="history-panel">
    <div style="color:var(--gold); font-size:12px; margin-bottom:10px;">ğŸ“Š çœŸå¯¦ç›²æ¸¬ Panelï¼ˆåŸºæ–¼æ­·å²çµ±è¨ˆï¼‰</div>
    <table>
        <thead><tr><th>æ—¥æœŸ</th><th>é–‹ç</th><th>é æ¸¬ 8 ç¢¼</th><th>æ˜Ÿæ•¸</th></tr></thead>
        <tbody id="historyBody"></tbody>
    </table>
</div>

<div class="footer">
    <input type="file" id="csvFile" style="display:none;" accept=".csv">
    <button class="btn-upload" onclick="document.getElementById('csvFile').click()">ğŸ“¤ åŸ·è¡ŒçœŸå¯¦ç›²æ¸¬ (ä¸æ³¨æ°´)</button>
</div>

<script>
    let rawLines = [];
    function addLog(msg) {
        const box = document.getElementById('logBox');
        box.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
        box.scrollTop = box.scrollHeight;
    }

    document.getElementById('csvFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(evt) {
            rawLines = evt.target.result.split('\n').filter(l => l.trim() !== "" && !l.includes('æ—¥æœŸ'));
            addLog(`ğŸ“‚ è®€å–æˆåŠŸï¼š${rawLines.length} ç­†çœŸå¯¦æ•¸æ“šã€‚`);
            runTrueBacktest();
        };
        reader.readAsText(file);
    });

    function runTrueBacktest() {
        const body = document.getElementById('historyBody');
        body.innerHTML = "";
        
        // å¾ç¬¬ 10 ç­†é–‹å§‹è·‘ï¼Œå› ç‚ºéœ€è¦å‰ 10 ç­†ç•¶çµ±è¨ˆåŸºåº•
        for (let i = rawLines.length - 1; i >= 10; i--) {
            const currentLine = rawLines[i].split(',');
            const date = currentLine[0];
            const real = currentLine.slice(1, 6).map(n => n.trim().padStart(2, '0'));
            
            // é—œéµï¼šé æ¸¬å‡½æ•¸åªæ‹¿ i ä¹‹å‰çš„æ•¸æ“š
            const pred = calculatePredict(rawLines.slice(0, i)); 
            const hits = pred.filter(n => real.includes(n));

            body.innerHTML += `
                <tr>
                    <td>${date}</td>
                    <td style="color:#888">${real.join(',')}</td>
                    <td>${pred.map(n => real.includes(n) ? `<span class="hit-num">${n}</span>` : n).join(',')}</td>
                    <td style="color:${hits.length >= 3 ? '#ff4444' : '#666'}">${hits.length}</td>
                </tr>`;
        }
    }

    function calculatePredict(history) {
        // çœŸå¯¦çµ±è¨ˆé‚è¼¯ï¼šå–å‡ºç¾é »ç‡æœ€é«˜çš„ 4 ç¢¼ + éºæ¼æœ€ä¹…çš„ 4 ç¢¼
        let counts = {};
        history.forEach(line => {
            line.split(',').slice(1,6).forEach(n => {
                let num = n.trim().padStart(2, '0');
                counts[num] = (counts[num] || 0) + 1;
            });
        });
        // æ’åºå–å‰ 8 å
        return Object.entries(counts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 8)
            .map(x => x[0])
            .sort();
    }
</script>
</body>
</html>
