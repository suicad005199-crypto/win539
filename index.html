<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>539 æ™ºæ…§æˆ°ç•¥é¢ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .num-btn { @apply w-10 h-10 flex items-center justify-center rounded-lg border border-gray-200 font-bold transition-all hover:bg-orange-50 text-slate-600; }
        .num-btn.selected { @apply bg-orange-500 border-orange-600 text-white shadow-md scale-110; }
        .hot-tag { @apply bg-red-100 text-red-600 px-2 py-0.5 rounded text-xs font-bold border border-red-200; }
        .tab-btn { @apply flex-1 py-3 text-sm font-bold transition-all border-b-2; }
        .tab-active { @apply border-orange-500 text-orange-600 bg-orange-50; }
        .tab-inactive { @apply border-transparent text-gray-400 hover:text-gray-600; }
    </style>
</head>
<body class="bg-slate-50 p-4 font-sans">

    <div class="max-w-4xl mx-auto">
        <div class="flex bg-white rounded-xl shadow-sm overflow-hidden mb-6 border border-slate-100">
            <button onclick="switchSource('539')" id="tab-539" class="tab-btn tab-active">ä»Šå½© 539</button>
            <button onclick="switchSource('CA')" id="tab-CA" class="tab-btn tab-inactive">åŠ å· 539</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <div class="md:col-span-4 space-y-4">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center justify-between">
                        <span>ğŸ“Š è¶¨å‹¢åˆ†æ</span>
                        <span id="data-count" class="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-400">0 æœŸ</span>
                    </h3>
                    <div class="space-y-5">
                        <div>
                            <span class="text-xs text-slate-400 font-bold">å¼·å‹¢å°¾æ•¸ (è¿½ 2 æ˜Ÿé¦–é¸)</span>
                            <div id="hot-tails" class="flex flex-wrap gap-2 mt-2">
                                <span class="text-slate-300 text-xs italic">é»æ“Šæ›´æ–°è®€å–æ•¸æ“š...</span>
                            </div>
                        </div>
                        <div class="pt-4 border-t border-slate-50">
                            <div class="flex justify-between text-xs font-bold mb-2">
                                <span class="text-slate-400">å¤§è™Ÿåˆ†ä½ˆ (20-39)</span>
                                <span id="size-ratio" class="text-slate-700">0%</span>
                            </div>
                            <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden">
                                <div id="size-bar" class="bg-blue-500 h-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-900 p-5 rounded-2xl shadow-xl text-white">
                    <h3 class="text-slate-400 text-xs font-bold mb-4">æŠ•æ³¨è©¦ç®—æ©Ÿ</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <span class="text-sm text-slate-400">é¸å–è™Ÿç¢¼</span>
                            <span id="selected-count" class="text-2xl font-mono text-orange-400">0</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 pt-2">
                            <div class="bg-slate-800 p-2 rounded">
                                <p class="text-[10px] text-slate-500">2 æ˜Ÿæ³¨æ•¸</p>
                                <p id="star2-count" class="font-bold">0</p>
                            </div>
                            <div class="bg-slate-800 p-2 rounded">
                                <p class="text-[10px] text-slate-500">3 æ˜Ÿæ³¨æ•¸</p>
                                <p id="star3-count" class="font-bold">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="fetchData()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-orange-200 transition-all active:scale-95">
                    æ›´æ–° API æ•¸æ“š
                </button>
            </div>

            <div class="md:col-span-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-bold text-slate-700 flex items-center">
                        <span id="current-title">ä»Šå½© 539</span>
                        <span class="ml-2 text-xs font-normal text-slate-400">æ™ºèƒ½é¸è™Ÿç›¤</span>
                    </h2>
                    <button onclick="clearSelection()" class="text-xs text-slate-400 hover:text-red-500">æ¸…é™¤å…¨éƒ¨</button>
                </div>
                
                <div class="grid grid-cols-5 sm:grid-cols-10 gap-2 mb-8" id="number-grid"></div>

                <div class="border-t border-slate-50 pt-6">
                    <h4 class="text-sm font-bold text-slate-700 mb-3">æˆ°ç•¥éæ¿¾å»ºè­°</h4>
                    <div id="strategy-tip" class="text-sm text-slate-500 bg-slate-50 p-4 rounded-xl leading-relaxed">
                        è«‹é»æ“Šæ›´æ–°æ•¸æ“šï¼Œç³»çµ±å°‡åˆ†æ 2026/01/01 è‡³ä»Šçš„è¶¨å‹¢...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbxX4EPXapWEH0l7yodiQjAquQQMNq73WkChSIuWnsd3_p59grPf9AKsrN32TtMXydBa-A/exec';
        let currentSource = '539';
        let selectedNumbers = [];

        function initGrid() {
            const grid = document.getElementById('number-grid');
            grid.innerHTML = '';
            for (let i = 1; i <= 39; i++) {
                const num = i.toString().padStart(2, '0');
                const btn = document.createElement('button');
                btn.className = 'num-btn';
                btn.innerText = num;
                btn.onclick = () => {
                    btn.classList.toggle('selected');
                    if (selectedNumbers.includes(num)) selectedNumbers = selectedNumbers.filter(n => n !== num);
                    else selectedNumbers.push(num);
                    updateCalc();
                };
                grid.appendChild(btn);
            }
        }

        function switchSource(type) {
            currentSource = type;
            document.getElementById('tab-539').className = `tab-btn ${type==='539'?'tab-active':'tab-inactive'}`;
            document.getElementById('tab-CA').className = `tab-btn ${type==='CA'?'tab-active':'tab-inactive'}`;
            document.getElementById('current-title').innerText = type === '539' ? 'ä»Šå½© 539' : 'åŠ å· 539';
            clearSelection();
            fetchData();
        }

        function updateCalc() {
            const n = selectedNumbers.length;
            document.getElementById('selected-count').innerText = n;
            document.getElementById('star2-count').innerText = n < 2 ? 0 : (n * (n - 1) / 2);
            document.getElementById('star3-count').innerText = n < 3 ? 0 : (n * (n - 1) * (n - 2) / 6);
        }

        function clearSelection() {
            selectedNumbers = [];
            document.querySelectorAll('.num-btn').forEach(b => b.classList.remove('selected'));
            updateCalc();
        }

        async function fetchData() {
            const tip = document.getElementById('strategy-tip');
            tip.innerText = "æ­£åœ¨åŒæ­¥ Google Sheet æ•¸æ“š...";
            try {
                const response = await fetch(`${API_URL}?sheet=${currentSource}`);
                const data = await response.json();
                analyzeData(data);
            } catch (e) {
                tip.innerHTML = "<span class='text-red-500'>é€£ç·šå¤±æ•—ï¼Œè«‹ç¢ºèª API å·²ç™¼ä½ˆç‚ºã€Œæ‰€æœ‰äººã€çš†å¯å­˜å–ã€‚</span>";
            }
        }

        function analyzeData(data) {
            const tails = {};
            let bigCount = 0;
            let totalBalls = 0;

            data.forEach(row => {
                const nums = [row['çè™Ÿ1'], row['çè™Ÿ2'], row['çè™Ÿ3'], row['çè™Ÿ4'], row['çè™Ÿ5']];
                nums.forEach(n => {
                    const val = parseInt(n);
                    if (!isNaN(val)) {
                        const tail = val % 10;
                        tails[tail] = (tails[tail] || 0) + 1;
                        if (val >= 20) bigCount++;
                        totalBalls++;
                    }
                });
            });

            // æ¸²æŸ“è¶¨å‹¢
            const sortedTails = Object.entries(tails).sort((a,b)=>b[1]-a[1]).slice(0,3);
            document.getElementById('hot-tails').innerHTML = sortedTails.map(t=>`<span class="hot-tag">${t[0]} å°¾</span>`).join('');
            
            const bigRatio = ((bigCount / totalBalls) * 100).toFixed(0);
            document.getElementById('size-ratio').innerText = bigRatio + '%';
            document.getElementById('size-bar').style.width = bigRatio + '%';
            document.getElementById('data-count').innerText = data.length + ' æœŸ';

            document.getElementById('strategy-tip').innerHTML = `
                <b>ç­–ç•¥è§£æï¼š</b><br>
                1. <b>è¿½å°¾ï¼š</b>ç›®å‰å¼·å‹¢å°¾æ•¸ç‚º <b>${sortedTails.map(t=>t[0]).join(', ')}</b>ï¼Œå»ºè­°å¾ä¸­é¸ 2 ç¢¼ã€‚<br>
                2. <b>å¤§å°ï¼š</b>å¤§è™Ÿä½”æ¯” ${bigRatio}%ï¼Œ${bigRatio > 60 ? 'è¿‘æœŸå¤§è™Ÿåå¤šï¼Œå»ºè­°é…ç½® 3å¤§2å°' : 'åˆ†ä½ˆå¹³å‡ï¼Œå»ºè­° 2å¤§3å°'}ã€‚<br>
                3. <b>ç©©å®šç²åˆ©ï¼š</b>é¸å– 6 ç¢¼é€²è¡Œ 2 æ˜Ÿé€£ç¢°åƒ…éœ€ 15 æ³¨ï¼Œä¸­ 2 ç¢¼å³ä¿æœ¬ã€‚
            `;
        }

        initGrid();
    </script>
</body>
</html>
